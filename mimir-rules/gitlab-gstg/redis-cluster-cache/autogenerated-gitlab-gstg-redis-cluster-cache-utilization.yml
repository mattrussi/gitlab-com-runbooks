# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./mimir-rules-jsonnet/utilization.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: Utilization Rules (autogenerated)
  interval: 5m
  rules:
  - record: gitlab_component_utilization:kube_node_cpu_requests_percent:1h
    labels:
      component: kube_node_cpu_requests
      metrics_subsystem: utilization
      resource_labels: type,shard
      summaryType: aggregate
      unit: percent
    expr: |
      avg by (env,tier,type,stage,shard) (
        sum by (env,tier,type,stage,node) (
          kube_pod_container_resource_requests{resource="cpu", unit="core", env="gstg",type="redis-cluster-cache"}
        )
        / on (node) group_left(cluster,env,tier,type,stage,shard)
        kube_node_status_allocatable:labeled{env="gstg",type="redis-cluster-cache",resource="cpu"}
      )
      * 100
  - record: gitlab_component_utilization:kube_node_memory_requests_percent:1h
    labels:
      component: kube_node_memory_requests
      metrics_subsystem: utilization
      resource_labels: type,shard
      summaryType: aggregate
      unit: percent
    expr: |
      avg by (env,tier,type,stage,shard) (
        sum by (env,tier,type,stage,node) (
          kube_pod_container_resource_requests{resource="memory", unit="byte", env="gstg",type="redis-cluster-cache"}
        )
        / on (node) group_left(cluster,env,tier,type,stage,shard)
        kube_node_status_allocatable:labeled{env="gstg",type="redis-cluster-cache",resource="memory"}
      )
      * 100
