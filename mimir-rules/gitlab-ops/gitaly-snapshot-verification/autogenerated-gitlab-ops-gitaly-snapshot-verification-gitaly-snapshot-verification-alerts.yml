# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./mimir-rules-jsonnet/gitaly-snapshot-verification.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: Gitaly Snapshot Verification Alerts
  interval: 1m
  rules:
  - alert: GitalySnapshotVerificationDelayed
    for: 1h
    annotations:
      title: Gitaly snapshot verification is delayed
      description: |
        Gitaly snapshot verification has not completed in the last day for the `{{ $labels.env }}` environment.

        This could indicate issues with the snapshot verification process or that snapshots are not being properly verified, which may impact disaster recovery capabilities.
    labels:
      alert_type: cause
      severity: s4
      team: data-access:durability
    expr: |
      time() - max(gitaly_snapshot_verification_finish_timestamp_seconds{}) by (env) > 86400
  - alert: GitalySnapshotVerificationNoRecentChanges
    for: 1h
    annotations:
      title: Gitaly snapshot verification found no recent changes
      description: |
        Gitaly snapshot verification didn't find any repository with a change committed in the last day for the restored instance `{{ $labels.gcp_project }}`/`{{ $labels.instance_name }}`.

        This could indicate a problem with the snapshotting process or the snapshot used was not restored properly.
    labels:
      alert_type: cause
      severity: s4
      team: data-access:durability
    expr: |
      gitaly_snapshot_verification_recent_repos_total{} == 0
