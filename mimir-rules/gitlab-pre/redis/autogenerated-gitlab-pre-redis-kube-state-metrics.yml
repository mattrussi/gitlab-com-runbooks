# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./mimir-rules-jsonnet/kube-state-metrics-recording-rules.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: 'kube-state-metrics-recording-rules: redis'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: db
      type: redis
    expr: |
      group without(label_stage,label_shard,label_deployment) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment,cluster,pod) (1, kube_pod_labels{env="pre",label_type="redis"}),
              "stage", "$0", "label_stage", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "deployment", "$0", "label_deployment", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: db
      type: redis
    expr: |
      group without(label_stage,label_shard) (
        label_replace(
          label_replace(
            topk by(environment,cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{env="pre",label_type="redis"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "label_shard", ".*"
        )
      )
  - record: kube_node_labels:labeled
    labels:
      tier: db
      type: redis
    expr: |
      group without(label_stage,label_shard) (
        label_replace(
          label_replace(
            topk by(environment,cluster,node) (1, kube_node_labels{env="pre",label_type="redis"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "label_shard", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: db
      type: redis
    expr: |
      group without(label_stage,label_shard) (
        label_replace(
          label_replace(
            topk by(environment,cluster,deployment) (1, kube_deployment_labels{env="pre",label_type="redis"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "label_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: enriched label recording rules'
  interval: 1m
  rules:
  - record: container_start_time_seconds:labeled
    expr: |
      container_start_time_seconds{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_cpu_cfs_periods_total:labeled
    expr: |
      container_cpu_cfs_periods_total{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_cpu_cfs_throttled_periods_total:labeled
    expr: |
      container_cpu_cfs_throttled_periods_total{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_cpu_cfs_throttled_seconds_total:labeled
    expr: |
      container_cpu_cfs_throttled_seconds_total{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_cpu_usage_seconds_total:labeled
    expr: |
      container_cpu_usage_seconds_total{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_memory_cache:labeled
    expr: |
      container_memory_cache{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_memory_rss:labeled
    expr: |
      container_memory_rss{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_memory_swap:labeled
    expr: |
      container_memory_swap{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_memory_usage_bytes:labeled
    expr: |
      container_memory_usage_bytes{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_memory_working_set_bytes:labeled
    expr: |
      container_memory_working_set_bytes{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_network_receive_bytes_total:labeled
    expr: |
      container_network_receive_bytes_total{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_network_transmit_bytes_total:labeled
    expr: |
      container_network_transmit_bytes_total{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_spec_cpu_period:labeled
    expr: |
      container_spec_cpu_period{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_spec_cpu_quota:labeled
    expr: |
      container_spec_cpu_quota{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_spec_cpu_shares:labeled
    expr: |
      container_spec_cpu_shares{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: container_spec_memory_limit_bytes:labeled
    expr: |
      container_spec_memory_limit_bytes{env="pre",metrics_path="/metrics/cadvisor"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_resource_limits:labeled
    expr: |
      kube_pod_container_resource_limits{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_resource_requests:labeled
    expr: |
      kube_pod_container_resource_requests{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_status_last_terminated_reason:labeled
    expr: |
      kube_pod_container_status_last_terminated_reason{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_status_ready:labeled
    expr: |
      kube_pod_container_status_ready{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_status_restarts_total:labeled
    expr: |
      kube_pod_container_status_restarts_total{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_status_running:labeled
    expr: |
      kube_pod_container_status_running{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_status_terminated:labeled
    expr: |
      kube_pod_container_status_terminated{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_status_terminated_reason:labeled
    expr: |
      kube_pod_container_status_terminated_reason{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_status_waiting:labeled
    expr: |
      kube_pod_container_status_waiting{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_pod_container_status_waiting_reason:labeled
    expr: |
      kube_pod_container_status_waiting_reason{env="pre"}
      *
      on(environment,cluster,pod) group_left(tier,type,stage,shard,deployment)
      topk by (environment,cluster,pod) (1, kube_pod_labels:labeled{env="pre",type=~"redis"})
  - record: kube_horizontalpodautoscaler_spec_target_metric:labeled
    expr: |
      kube_horizontalpodautoscaler_spec_target_metric{env="pre"}
      *
      on(environment,cluster,horizontalpodautoscaler) group_left(tier,type,stage,shard)
      topk by (environment,cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{env="pre",type=~"redis"})
  - record: kube_horizontalpodautoscaler_status_condition:labeled
    expr: |
      kube_horizontalpodautoscaler_status_condition{env="pre"}
      *
      on(environment,cluster,horizontalpodautoscaler) group_left(tier,type,stage,shard)
      topk by (environment,cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{env="pre",type=~"redis"})
  - record: kube_horizontalpodautoscaler_status_current_replicas:labeled
    expr: |
      kube_horizontalpodautoscaler_status_current_replicas{env="pre"}
      *
      on(environment,cluster,horizontalpodautoscaler) group_left(tier,type,stage,shard)
      topk by (environment,cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{env="pre",type=~"redis"})
  - record: kube_horizontalpodautoscaler_status_desired_replicas:labeled
    expr: |
      kube_horizontalpodautoscaler_status_desired_replicas{env="pre"}
      *
      on(environment,cluster,horizontalpodautoscaler) group_left(tier,type,stage,shard)
      topk by (environment,cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{env="pre",type=~"redis"})
  - record: kube_horizontalpodautoscaler_metadata_generation:labeled
    expr: |
      kube_horizontalpodautoscaler_metadata_generation{env="pre"}
      *
      on(environment,cluster,horizontalpodautoscaler) group_left(tier,type,stage,shard)
      topk by (environment,cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{env="pre",type=~"redis"})
  - record: kube_horizontalpodautoscaler_spec_max_replicas:labeled
    expr: |
      kube_horizontalpodautoscaler_spec_max_replicas{env="pre"}
      *
      on(environment,cluster,horizontalpodautoscaler) group_left(tier,type,stage,shard)
      topk by (environment,cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{env="pre",type=~"redis"})
  - record: kube_horizontalpodautoscaler_spec_min_replicas:labeled
    expr: |
      kube_horizontalpodautoscaler_spec_min_replicas{env="pre"}
      *
      on(environment,cluster,horizontalpodautoscaler) group_left(tier,type,stage,shard)
      topk by (environment,cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{env="pre",type=~"redis"})
  - record: kube_node_status_capacity:labeled
    expr: |
      kube_node_status_capacity{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: kube_node_status_allocatable:labeled
    expr: |
      kube_node_status_allocatable{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: kube_node_status_condition:labeled
    expr: |
      kube_node_status_condition{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_schedstat_waiting_seconds_total:labeled
    expr: |
      node_schedstat_waiting_seconds_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_cpu_seconds_total:labeled
    expr: |
      node_cpu_seconds_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_network_transmit_bytes_total:labeled
    expr: |
      node_network_transmit_bytes_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_network_receive_bytes_total:labeled
    expr: |
      node_network_receive_bytes_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_disk_reads_completed_total:labeled
    expr: |
      node_disk_reads_completed_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_disk_writes_completed_total:labeled
    expr: |
      node_disk_writes_completed_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_disk_read_bytes_total:labeled
    expr: |
      node_disk_read_bytes_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_disk_written_bytes_total:labeled
    expr: |
      node_disk_written_bytes_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_disk_read_time_seconds_total:labeled
    expr: |
      node_disk_read_time_seconds_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_disk_write_time_seconds_total:labeled
    expr: |
      node_disk_write_time_seconds_total{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_load1:labeled
    expr: |
      node_load1{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_load5:labeled
    expr: |
      node_load5{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_load15:labeled
    expr: |
      node_load15{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: node_vmstat_oom_kill:labeled
    expr: |
      node_vmstat_oom_kill{env="pre"}
      *
      on(environment,cluster,node) group_left(tier,type,stage,shard)
      topk by (environment,cluster,node) (1, kube_node_labels:labeled{env="pre",type=~"redis"})
  - record: nginx_ingress_controller_requests:labeled
    expr: |
      nginx_ingress_controller_requests{env="pre"}
      *
      on(environment,cluster,ingress) group_left(tier,type,stage,shard)
      topk by (environment,cluster,ingress) (1, kube_ingress_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_status_replicas_unavailable:labeled
    expr: |
      kube_deployment_status_replicas_unavailable{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_status_replicas_updated:labeled
    expr: |
      kube_deployment_status_replicas_updated{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_spec_paused:labeled
    expr: |
      kube_deployment_spec_paused{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_spec_replicas:labeled
    expr: |
      kube_deployment_spec_replicas{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_spec_strategy_rollingupdate_max_surge:labeled
    expr: |
      kube_deployment_spec_strategy_rollingupdate_max_surge{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_spec_strategy_rollingupdate_max_unavailable:labeled
    expr: |
      kube_deployment_spec_strategy_rollingupdate_max_unavailable{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_status_condition:labeled
    expr: |
      kube_deployment_status_condition{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_status_replicas_available:labeled
    expr: |
      kube_deployment_status_replicas_available{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_created:labeled
    expr: |
      kube_deployment_created{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_metadata_generation:labeled
    expr: |
      kube_deployment_metadata_generation{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_status_observed_generation:labeled
    expr: |
      kube_deployment_status_observed_generation{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
  - record: kube_deployment_status_replicas:labeled
    expr: |
      kube_deployment_status_replicas{env="pre"}
      *
      on(environment,cluster,deployment) group_left(tier,type,stage,shard)
      topk by (environment,cluster,deployment) (1, kube_deployment_labels:labeled{env="pre",type=~"redis"})
