# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./mimir-rules-jsonnet/mimir-aggregations.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: 'Global SLI Metrics: mimir - Burn-Rate 5m'
  interval: 1m
  rules:
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_compactor_group_compaction_runs_started_total:rate_5m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_compactor_group_compactions_failures_total:rate_5m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_compactor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_5m
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_5m{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_5m{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_5m
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_5m{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_5m{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/distributor",le="0.5",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"}
        )
        +
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/distributor",le="1.0",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"}
        )
      )
      /
      2
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/distributor",le="+Inf",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/distributor",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/distributor",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_distributor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_5m
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_5m{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_5m{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_5m
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_5m{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_5m{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/ingester",le="0.1",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"}
        )
        +
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/ingester",le="1.0",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"}
        )
      )
      /
      2
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/ingester",le="+Inf",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/ingester",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/ingester",namespace="mimir",route="/cortex.Ingester/Push",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_ingester",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_5m
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_5m{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_5m{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_5m
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_5m{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_5m{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_bucket:rate_5m{job="mimir/querier",le="25.0",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_bucket:rate_5m{job="mimir/querier",le="+Inf",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_count:rate_5m{job="mimir/querier",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_querier_request_duration_seconds_count:rate_5m{job="mimir/querier",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_querier",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_5m
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_5m{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_5m{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_5m
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_5m{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_5m{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/query-frontend",le="25.0",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/query-frontend",le="+Inf",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/query-frontend",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/query-frontend",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_query_frontend",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_5m
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_5m{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_5m{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_5m
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_5m{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_5m{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_5m{job="mimir/query-scheduler",le="5.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_5m{job="mimir/query-scheduler",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_5m{job="mimir/query-scheduler",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_5m{job="mimir/query-scheduler",namespace="mimir",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_query_scheduler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_5m
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_5m{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_5m{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_5m
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_5m{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_5m{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_prometheus_rule_evaluations_total:rate_5m{job="mimir/ruler",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_prometheus_rule_evaluation_failures_total:rate_5m{job="mimir/ruler",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_ruler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_5m
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_5m{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_5m{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_5m
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_5m{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_5m{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/store-gateway",le="25.0",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/store-gateway",le="+Inf",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/store-gateway",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/store-gateway",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_store_gateway",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_5m
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_5m{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_5m{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_5m
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_5m{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_5m{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
- name: 'Global SLI Metrics: mimir - Burn-Rate 30m'
  interval: 2m
  rules:
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_compactor_group_compaction_runs_started_total:rate_30m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_compactor_group_compactions_failures_total:rate_30m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_compactor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_30m
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_30m{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_30m{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_30m
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_30m{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_30m{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/distributor",le="0.5",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"}
        )
        +
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/distributor",le="1.0",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"}
        )
      )
      /
      2
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/distributor",le="+Inf",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/distributor",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/distributor",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_distributor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_30m
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_30m{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_30m{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_30m
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_30m{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_30m{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/ingester",le="0.1",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"}
        )
        +
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/ingester",le="1.0",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"}
        )
      )
      /
      2
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/ingester",le="+Inf",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/ingester",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/ingester",namespace="mimir",route="/cortex.Ingester/Push",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_ingester",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_30m
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_30m{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_30m{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_30m
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_30m{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_30m{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_bucket:rate_30m{job="mimir/querier",le="25.0",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_bucket:rate_30m{job="mimir/querier",le="+Inf",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_count:rate_30m{job="mimir/querier",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_querier_request_duration_seconds_count:rate_30m{job="mimir/querier",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_querier",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_30m
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_30m{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_30m{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_30m
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_30m{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_30m{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/query-frontend",le="25.0",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/query-frontend",le="+Inf",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/query-frontend",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/query-frontend",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_query_frontend",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_30m
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_30m{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_30m{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_30m
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_30m{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_30m{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_30m{job="mimir/query-scheduler",le="5.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_30m{job="mimir/query-scheduler",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_30m{job="mimir/query-scheduler",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_30m{job="mimir/query-scheduler",namespace="mimir",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_query_scheduler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_30m
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_30m{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_30m{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_30m
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_30m{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_30m{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_prometheus_rule_evaluations_total:rate_30m{job="mimir/ruler",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_prometheus_rule_evaluation_failures_total:rate_30m{job="mimir/ruler",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_ruler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_30m
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_30m{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_30m{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_30m
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_30m{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_30m{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/store-gateway",le="25.0",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/store-gateway",le="+Inf",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/store-gateway",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/store-gateway",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_store_gateway",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_30m
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_30m{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_30m{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_30m
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_30m{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_30m{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
- name: 'Global SLI Metrics: mimir - Burn-Rate 1h'
  interval: 1m
  rules:
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_compactor_group_compaction_runs_started_total:rate_1h{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_compactor_group_compactions_failures_total:rate_1h{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_compactor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_1h
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_1h
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/distributor",le="0.5",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"}
        )
        +
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/distributor",le="1.0",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"}
        )
      )
      /
      2
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/distributor",le="+Inf",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/distributor",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/distributor",namespace="mimir",route=~"/distributor\\.Distributor/Push|/httpgrpc.*|(api_(v1|prom)_push)|otlp_v1_metrics",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_distributor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_1h
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_1h
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/ingester",le="0.1",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"}
        )
        +
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/ingester",le="1.0",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"}
        )
      )
      /
      2
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/ingester",le="+Inf",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/ingester",namespace="mimir",route="/cortex.Ingester/Push",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/ingester",namespace="mimir",route="/cortex.Ingester/Push",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_ingester",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_1h
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_1h
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_bucket:rate_1h{job="mimir/querier",le="25.0",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_bucket:rate_1h{job="mimir/querier",le="+Inf",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_count:rate_1h{job="mimir/querier",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_querier_request_duration_seconds_count:rate_1h{job="mimir/querier",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_querier",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_1h
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_1h
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/query-frontend",le="25.0",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/query-frontend",le="+Inf",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/query-frontend",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/query-frontend",namespace="mimir",route=~"prometheus_(api|prom)_v1_.+",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_query_frontend",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_1h
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_1h
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_1h{job="mimir/query-scheduler",le="5.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_1h{job="mimir/query-scheduler",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_1h{job="mimir/query-scheduler",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_1h{job="mimir/query-scheduler",namespace="mimir",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_query_scheduler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_1h
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_1h
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_prometheus_rule_evaluations_total:rate_1h{job="mimir/ruler",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_prometheus_rule_evaluation_failures_total:rate_1h{job="mimir/ruler",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_ruler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_1h
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_1h
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/store-gateway",le="25.0",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/store-gateway",le="+Inf",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/store-gateway",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/store-gateway",namespace="mimir",route=~"/gatewaypb\\.StoreGateway/.*",status_code=~"^5.*",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_store_gateway",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_errors:ratio_1h
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_1h
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
- name: 'Global SLI Metrics: mimir - Burn-Rate 6h'
  interval: 2m
  rules:
  - record: gitlab_component_apdex:success:rate_6h
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_6h
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_ops:rate_6h
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:rate_6h
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:ratio_6h
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_6h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_6h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_6h
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_6h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_6h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_6h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_6h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_ops:rate_6h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:rate_6h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:ratio_6h
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_6h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_6h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_6h
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_6h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_6h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_6h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_6h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_ops:rate_6h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:rate_6h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:ratio_6h
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_6h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_6h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_6h
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_6h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_6h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_6h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_6h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_ops:rate_6h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:rate_6h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:ratio_6h
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_6h{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_6h{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_6h
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_6h{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_6h{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_6h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_6h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_ops:rate_6h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:rate_6h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:ratio_6h
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_6h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_6h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_6h
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_6h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_6h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_6h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_6h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_ops:rate_6h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:rate_6h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:ratio_6h
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_6h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_6h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_6h
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_6h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_6h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_6h
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_6h
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_ops:rate_6h
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:rate_6h
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:ratio_6h
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_6h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_6h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_6h
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_6h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_6h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_6h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_6h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_ops:rate_6h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:rate_6h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"}[6h] offset 30s)
      )
  - record: gitlab_component_errors:ratio_6h
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_6h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_6h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_6h
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_6h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_6h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
- name: 'Global SLI Metrics: mimir - Burn-Rate 3d'
  interval: 2m
  rules:
  - record: gitlab_component_apdex:success:rate_3d
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_3d
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_ops:rate_3d
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:rate_3d
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_compactor",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:ratio_3d
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_3d{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_3d{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_3d
    labels:
      component: mimir_compactor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_3d{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_3d{component="mimir_compactor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_3d
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_3d
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_ops:rate_3d
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:rate_3d
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_distributor",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:ratio_3d
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_3d{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_3d{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_3d
    labels:
      component: mimir_distributor
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_3d{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_3d{component="mimir_distributor",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_3d
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_3d
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_ops:rate_3d
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:rate_3d
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_ingester",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:ratio_3d
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_3d{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_3d{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_3d
    labels:
      component: mimir_ingester
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_3d{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_3d{component="mimir_ingester",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_3d
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_3d
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_ops:rate_3d
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:rate_3d
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_querier",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:ratio_3d
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_3d{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_3d{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_3d
    labels:
      component: mimir_querier
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_3d{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_3d{component="mimir_querier",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_3d
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_3d
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_ops:rate_3d
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:rate_3d
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:ratio_3d
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_3d{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_3d{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_3d
    labels:
      component: mimir_query_frontend
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_3d{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_3d{component="mimir_query_frontend",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_3d
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_3d
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_ops:rate_3d
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:rate_3d
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:ratio_3d
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_3d{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_3d{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_3d
    labels:
      component: mimir_query_scheduler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_3d{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_3d{component="mimir_query_scheduler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_3d
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_3d
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_ops:rate_3d
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:rate_3d
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_ruler",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:ratio_3d
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_3d{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_3d{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_3d
    labels:
      component: mimir_ruler
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_3d{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_3d{component="mimir_ruler",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:success:rate_3d
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:success:rate_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_apdex:weight:score_3d
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_apdex:weight:score_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_ops:rate_3d
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_ops:rate_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:rate_3d
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        avg_over_time(gitlab_component_errors:rate_1h{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"}[3d] offset 30s)
      )
  - record: gitlab_component_errors:ratio_3d
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_errors:rate_3d{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_ops:rate_3d{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
  - record: gitlab_component_apdex:ratio_3d
    labels:
      component: mimir_store_gateway
      monitor: global
      tier: inf
      type: mimir
    expr: |
      sum by (env,environment,stage) (
        gitlab_component_apdex:success:rate_3d{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
      /
      sum by (env,environment,stage) (
        gitlab_component_apdex:weight:score_3d{component="mimir_store_gateway",monitor="global",tier="inf",type="mimir"} offset 30s
      )
