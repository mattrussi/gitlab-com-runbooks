groups:
    - interval: 1m
      name: Saturation Rules (autogenerated)
      rules:
        - expr: |
            max by(shard) (
              clamp_min(
                clamp_max(
                  (
                    sum by (shard, type) (gitlab_runner_jobs)
                  /
                    sum by (shard, type) (gitlab_runner_concurrent)
                  )
                  ,
                  1)
              ,
              0)
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_saturation:ratio
    - interval: 1m
      name: 'Global Component SLI Metrics: hosted-runners - Burn-Rate 5m'
      rules:
        - expr: |
            sum by () (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_5m
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[5m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_5m{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_5m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            ) - (
              sum by () (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
              ) or
              0 * sum by () (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_5m
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_5m{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_5m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[5m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[5m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_5m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_5m
        - expr: |
            sum by () (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[5m])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_5m
        - expr: |
            (
              sum by () (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[5m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_5m{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_5m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_5m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_5m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_5m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_5m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_5m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[5m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_5m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[5m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_5m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[5m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_5m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_5m
    - interval: 2m
      name: 'Global Component SLI Metrics: hosted-runners - Burn-Rate 30m'
      rules:
        - expr: |
            sum by () (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_30m
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[30m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_30m{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_30m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            ) - (
              sum by () (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
              ) or
              0 * sum by () (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_30m
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_30m{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_30m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[30m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[30m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_30m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_30m
        - expr: |
            sum by () (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[30m])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_30m
        - expr: |
            (
              sum by () (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[30m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_30m{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_30m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_30m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_30m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_30m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_30m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_30m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[30m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_30m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[30m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_30m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[30m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_30m
        - expr: |
            sum by () (
              gitlab_component_errors:rate_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_30m
    - interval: 1m
      name: 'Global Component SLI Metrics: hosted-runners - Burn-Rate 1h'
      rules:
        - expr: |
            sum by () (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_1h
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[1h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_1h{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_1h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            ) - (
              sum by () (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
              ) or
              0 * sum by () (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_1h
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_1h{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_1h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[1h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[1h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_1h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_1h
        - expr: |
            sum by () (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[1h])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_1h
        - expr: |
            (
              sum by () (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[1h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_1h{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_1h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_1h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_1h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_1h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_1h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_1h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[1h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_1h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[1h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_1h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[1h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_1h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_1h
    - interval: 2m
      name: 'Global Component SLI Metrics: hosted-runners - Burn-Rate 6h'
      rules:
        - expr: |
            sum by () (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_6h
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[6h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_6h{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_6h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            ) - (
              sum by () (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
              ) or
              0 * sum by () (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_6h
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_6h{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_6h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[6h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[6h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_6h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_6h
        - expr: |
            sum by () (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[6h])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_6h
        - expr: |
            (
              sum by () (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[6h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_component_ops:rate_6h{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:rate_6h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_6h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_6h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_6h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_6h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_6h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[6h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:success:rate_6h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[6h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:weight:score_6h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[6h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_ops:rate_6h
        - expr: |
            sum by () (
              gitlab_component_errors:rate_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_ops:rate_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_component_apdex:success:rate_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_component_apdex:weight:score_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_apdex:ratio_6h
    - interval: 1m
      name: 'Global Service-Aggregated Metrics: hosted-runners - Burn-Rate 5m'
      rules:
        - expr: |
            sum by () (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_5m
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[5m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_5m{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_5m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            ) - (
              sum by () (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
              ) or
              0 * sum by () (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_5m
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_5m{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_5m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[5m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[5m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_5m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_5m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_5m
        - expr: |
            sum by () (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[5m])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_5m
        - expr: |
            (
              sum by () (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[5m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_5m{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_5m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_5m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_5m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_5m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_5m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_5m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[5m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_5m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[5m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_5m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[5m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_5m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_5m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_5m
    - interval: 2m
      name: 'Global Service-Aggregated Metrics: hosted-runners - Burn-Rate 30m'
      rules:
        - expr: |
            sum by () (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_30m
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[30m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_30m{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_30m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            ) - (
              sum by () (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
              ) or
              0 * sum by () (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_30m
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_30m{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_30m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[30m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[30m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_30m
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_30m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_30m
        - expr: |
            sum by () (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[30m])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_30m
        - expr: |
            (
              sum by () (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[30m])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_30m{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_30m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_30m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_30m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_30m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_30m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_30m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[30m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_30m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[30m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_30m
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[30m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_30m
        - expr: |
            sum by () (
              gitlab_service_errors:rate_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_30m
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_30m
    - interval: 1m
      name: 'Global Service-Aggregated Metrics: hosted-runners - Burn-Rate 1h'
      rules:
        - expr: |
            sum by () (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_1h
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[1h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_1h{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_1h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            ) - (
              sum by () (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
              ) or
              0 * sum by () (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_1h
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_1h{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_1h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[1h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[1h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_1h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_1h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_1h
        - expr: |
            sum by () (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[1h])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_1h
        - expr: |
            (
              sum by () (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[1h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_1h{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_1h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_1h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_1h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_1h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_1h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_1h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[1h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_1h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[1h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_1h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[1h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_1h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_1h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_1h
    - interval: 2m
      name: 'Global Service-Aggregated Metrics: hosted-runners - Burn-Rate 6h'
      rules:
        - expr: |
            sum by () (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_6h
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[6h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_6h{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_6h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            ) - (
              sum by () (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
              ) or
              0 * sum by () (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_6h
        - expr: |
            (
              sum by () (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_6h{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_6h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[6h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[6h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_6h
        - expr: |
            sum by () (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_6h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_6h
        - expr: |
            sum by () (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[6h])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_6h
        - expr: |
            (
              sum by () (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[6h])
              )
            )
            or
            (
              0 * group by() (
                gitlab_service_ops:rate_6h{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:rate_6h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_6h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_6h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_6h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_6h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_6h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[6h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:success:rate_6h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[6h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:weight:score_6h
        - expr: |
            sum by () (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[6h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_service_ops:rate_6h
        - expr: |
            sum by () (
              gitlab_service_errors:rate_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_ops:rate_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_service_errors:ratio_6h
        - expr: |
            sum by () (
              gitlab_service_apdex:success:rate_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by () (
              gitlab_service_apdex:weight:score_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_service_apdex:ratio_6h
    - interval: 1m
      name: 'Global Shard-Aggregated SLI Metrics: hosted-runners - Burn-Rate 5m'
      rules:
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_5m
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[5m])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_5m{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_5m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            ) - (
              sum by (shard) (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
              ) or
              0 * sum by (shard) (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_5m
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_5m{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_5m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[5m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[5m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[5m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_5m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[5m])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_5m
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[5m])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_5m{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_5m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_5m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_5m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_5m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[5m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[5m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_5m
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[5m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_5m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_5m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_5m
    - interval: 2m
      name: 'Global Shard-Aggregated SLI Metrics: hosted-runners - Burn-Rate 30m'
      rules:
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_30m
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[30m])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_30m{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_30m{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            ) - (
              sum by (shard) (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
              ) or
              0 * sum by (shard) (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_30m
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_30m{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_30m{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[30m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[30m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[30m])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_30m{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[30m])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_30m
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[30m])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_30m{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_30m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_30m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_30m{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_30m{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[30m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[30m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_30m
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[30m])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_30m
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_30m{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_30m
    - interval: 1m
      name: 'Global Shard-Aggregated SLI Metrics: hosted-runners - Burn-Rate 1h'
      rules:
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_1h
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[1h])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_1h{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_1h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            ) - (
              sum by (shard) (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
              ) or
              0 * sum by (shard) (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_1h
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_1h{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_1h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[1h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[1h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[1h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_1h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[1h])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_1h
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[1h])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_1h{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_1h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_1h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_1h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_1h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[1h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[1h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_1h
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[1h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_1h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_1h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_1h
    - interval: 2m
      name: 'Global Shard-Aggregated SLI Metrics: hosted-runners - Burn-Rate 6h'
      rules:
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_6h
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_runner_api_request_statuses_total{job="hosted-runners-prometheus-agent",shard=~".*",status=~"5.."}[6h])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_6h{component="api_requests",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: api_requests
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_6h{component="api_requests",tier="inf",type="hosted-runners"}
            )
          labels:
            component: api_requests
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            ) - (
              sum by (shard) (
                rate(gitlab_runner_acceptable_job_queuing_duration_exceeded_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
              ) or
              0 * sum by (shard) (
                rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_jobs_total{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_6h
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_runner_failed_jobs_total{failure_reason="runner_system_failure",job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_6h{component="ci_runner_jobs",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: ci_runner_jobs
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_6h{component="ci_runner_jobs",tier="inf",type="hosted-runners"}
            )
          labels:
            component: ci_runner_jobs
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="300",shard=~".*"}[6h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_bucket{job="hosted-runners-prometheus-agent",le="+Inf",shard=~".*"}[6h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_runner_job_queue_duration_seconds_count{job="hosted-runners-prometheus-agent",shard=~".*"}[6h])
            )
          labels:
            component: pending_builds
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_6h{component="pending_builds",tier="inf",type="hosted-runners"}
            )
          labels:
            component: pending_builds
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_workhorse_http_requests_total{route="^/api/v4/jobs/request\\z"}[6h])
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_6h
        - expr: |
            (
              sum by (shard) (
                rate(gitlab_workhorse_http_requests_total{code=~"5..",route="^/api/v4/jobs/request\\z"}[6h])
              )
            )
            or
            (
              0 * group by(shard) (
                gitlab_component_shard_ops:rate_6h{component="polling",stage="main",tier="inf",type="hosted-runners"}
              )
            )
          labels:
            component: polling
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:rate_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_6h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_6h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_6h{component="polling",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_6h{component="polling",tier="inf",type="hosted-runners"}
            )
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="0.5"}[6h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:success:rate_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_bucket{le="+Inf"}[6h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:weight:score_6h
        - expr: |
            sum by (shard) (
              rate(gitlab_ci_queue_retrieval_duration_seconds_count{}[6h])
            )
          labels:
            component: queuing_queries_duration
            stage: main
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_ops:rate_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_errors:rate_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_ops:rate_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_errors:ratio_6h
        - expr: |
            sum by (shard) (
              gitlab_component_shard_apdex:success:rate_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
            /
            sum by (shard) (
              gitlab_component_shard_apdex:weight:score_6h{component="queuing_queries_duration",tier="inf",type="hosted-runners"}
            )
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: gitlab_component_shard_apdex:ratio_6h
    - interval: 5m
      name: Autogenerated Service SLOs
      rules:
        - expr: "0.970000"
          labels:
            tier: inf
            type: hosted-runners
          record: slo:min:events:gitlab_service_apdex:ratio
        - expr: "0.001000"
          labels:
            tier: inf
            type: hosted-runners
          record: slo:max:events:gitlab_service_errors:ratio
        - expr: "0.970000"
          labels:
            component: api_requests
            shard: ""
            tier: inf
            type: hosted-runners
          record: slo:min:events:gitlab_service_apdex:ratio
        - expr: "0.001000"
          labels:
            component: api_requests
            shard: ""
            tier: inf
            type: hosted-runners
          record: slo:max:events:gitlab_service_errors:ratio
        - expr: "0.970000"
          labels:
            component: ci_runner_jobs
            shard: ""
            tier: inf
            type: hosted-runners
          record: slo:min:events:gitlab_service_apdex:ratio
        - expr: "0.001000"
          labels:
            component: ci_runner_jobs
            shard: ""
            tier: inf
            type: hosted-runners
          record: slo:max:events:gitlab_service_errors:ratio
        - expr: "0.970000"
          labels:
            component: pending_builds
            shard: ""
            tier: inf
            type: hosted-runners
          record: slo:min:events:gitlab_service_apdex:ratio
        - expr: "0.001000"
          labels:
            component: pending_builds
            shard: ""
            tier: inf
            type: hosted-runners
          record: slo:max:events:gitlab_service_errors:ratio
        - expr: "0.970000"
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: slo:min:events:gitlab_service_apdex:ratio
        - expr: "0.001000"
          labels:
            component: polling
            tier: inf
            type: hosted-runners
          record: slo:max:events:gitlab_service_errors:ratio
        - expr: "0.999000"
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: slo:min:events:gitlab_service_apdex:ratio
        - expr: "0.001000"
          labels:
            component: queuing_queries_duration
            tier: inf
            type: hosted-runners
          record: slo:max:events:gitlab_service_errors:ratio
    - interval: 1m
      name: 'Component mapping: hosted-runners'
      rules:
        - expr: "1"
          labels:
            component: api_requests
            regional_aggregation: "no"
            service_aggregation: "no"
            tier: inf
            type: hosted-runners
          record: gitlab_component_service:mapping
        - expr: "1"
          labels:
            component: ci_runner_jobs
            regional_aggregation: "no"
            service_aggregation: "yes"
            tier: inf
            type: hosted-runners
          record: gitlab_component_service:mapping
        - expr: "1"
          labels:
            component: pending_builds
            regional_aggregation: "no"
            service_aggregation: "yes"
            tier: inf
            type: hosted-runners
          record: gitlab_component_service:mapping
        - expr: "1"
          labels:
            component: polling
            regional_aggregation: "no"
            service_aggregation: "no"
            tier: inf
            type: hosted-runners
          record: gitlab_component_service:mapping
        - expr: "1"
          labels:
            component: queuing_queries_duration
            regional_aggregation: "no"
            service_aggregation: "no"
            tier: inf
            type: hosted-runners
          record: gitlab_component_service:mapping
