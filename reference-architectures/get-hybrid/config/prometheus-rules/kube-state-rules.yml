# WARNING. DO NOT EDIT THIS FILE BY HAND. RUN ./scripts/generate-all-reference-architecture-configs.sh TO GENERATE IT. YOUR CHANGES WILL BE OVERRIDDEN
groups:
- interval: 1m
  name: 'kube-state-metrics-recording-rules: consul'
  rules:
  - expr: |
      group without(label_deployment) (
        label_replace(
          topk by(cluster,pod) (1, kube_pod_labels{namespace="consul"}),
          "deployment", "$0", "label_deployment", ".*"
        )
      )
    labels:
      tier: inf
      type: consul
    record: kube_pod_labels:labeled
- interval: 1m
  name: 'kube-state-metrics-recording-rules: gitlab-shell'
  rules:
  - expr: |
      group without(label_deployment) (
        label_replace(
          topk by(cluster,pod) (1, kube_pod_labels{label_app="gitlab-shell"}),
          "deployment", "$0", "label_deployment", ".*"
        )
      )
    labels:
      tier: sv
      type: gitlab-shell
    record: kube_pod_labels:labeled
  - expr: topk by(cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{horizontalpodautoscaler="gitlab-gitlab-shell"})
    labels:
      tier: sv
      type: gitlab-shell
    record: kube_horizontalpodautoscaler_labels:labeled
  - expr: topk by(cluster,deployment) (1, kube_deployment_labels{label_app="gitlab-shell"})
    labels:
      tier: sv
      type: gitlab-shell
    record: kube_deployment_labels:labeled
- interval: 1m
  name: 'kube-state-metrics-recording-rules: registry'
  rules:
  - expr: |
      group without(label_deployment) (
        label_replace(
          topk by(cluster,pod) (1, kube_pod_labels{label_app="registry"}),
          "deployment", "$0", "label_deployment", ".*"
        )
      )
    labels:
      tier: sv
      type: registry
    record: kube_pod_labels:labeled
  - expr: topk by(cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{horizontalpodautoscaler="gitlab-registry"})
    labels:
      tier: sv
      type: registry
    record: kube_horizontalpodautoscaler_labels:labeled
  - expr: topk by(cluster,ingress) (1, kube_ingress_labels{label_app="registry"})
    labels:
      tier: sv
      type: registry
    record: kube_ingress_labels:labeled
  - expr: topk by(cluster,deployment) (1, kube_deployment_labels{label_app="registry"})
    labels:
      tier: sv
      type: registry
    record: kube_deployment_labels:labeled
- interval: 1m
  name: 'kube-state-metrics-recording-rules: sidekiq'
  rules:
  - expr: |
      group without(label_deployment) (
        label_replace(
          topk by(cluster,pod) (1, kube_pod_labels{label_app="sidekiq"}),
          "deployment", "$0", "label_deployment", ".*"
        )
      )
    labels:
      tier: sv
      type: sidekiq
    record: kube_pod_labels:labeled
  - expr: topk by(cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{horizontalpodautoscaler="gitlab-sidekiq-all-in-1-v2"})
    labels:
      tier: sv
      type: sidekiq
    record: kube_horizontalpodautoscaler_labels:labeled
  - expr: topk by(cluster,node) (1, kube_node_labels{label_workload="sidekiq"})
    labels:
      tier: sv
      type: sidekiq
    record: kube_node_labels:labeled
  - expr: topk by(cluster,deployment) (1, kube_deployment_labels{label_app="sidekiq"})
    labels:
      tier: sv
      type: sidekiq
    record: kube_deployment_labels:labeled
- interval: 1m
  name: 'kube-state-metrics-recording-rules: webservice'
  rules:
  - expr: |
      group without(label_deployment) (
        label_replace(
          topk by(cluster,pod) (1, kube_pod_labels{label_app="webservice"}),
          "deployment", "$0", "label_deployment", ".*"
        )
      )
    labels:
      tier: sv
      type: webservice
    record: kube_pod_labels:labeled
  - expr: topk by(cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_app="webservice"})
    labels:
      tier: sv
      type: webservice
    record: kube_horizontalpodautoscaler_labels:labeled
  - expr: topk by(cluster,node) (1, kube_node_labels{label_eks_amazonaws_com_nodegroup="gitlab_webservice_pool"})
    labels:
      tier: sv
      type: webservice
    record: kube_node_labels:labeled
  - expr: topk by(cluster,ingress) (1, kube_ingress_labels{label_app="webservice"})
    labels:
      tier: sv
      type: webservice
    record: kube_ingress_labels:labeled
  - expr: topk by(cluster,deployment) (1, kube_deployment_labels{label_app="webservice"})
    labels:
      tier: sv
      type: webservice
    record: kube_deployment_labels:labeled
- interval: 1m
  name: 'kube-state-metrics-recording-rules: enriched label recording rules'
  rules:
  - expr: |
      container_start_time_seconds{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_start_time_seconds:labeled
  - expr: |
      container_cpu_cfs_periods_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_cpu_cfs_periods_total:labeled
  - expr: |
      container_cpu_cfs_throttled_periods_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_cpu_cfs_throttled_periods_total:labeled
  - expr: |
      container_cpu_cfs_throttled_seconds_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_cpu_cfs_throttled_seconds_total:labeled
  - expr: |
      container_cpu_usage_seconds_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_cpu_usage_seconds_total:labeled
  - expr: |
      container_memory_cache{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_memory_cache:labeled
  - expr: |
      container_memory_rss{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_memory_rss:labeled
  - expr: |
      container_memory_swap{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_memory_swap:labeled
  - expr: |
      container_memory_usage_bytes{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_memory_usage_bytes:labeled
  - expr: |
      container_memory_working_set_bytes{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_memory_working_set_bytes:labeled
  - expr: |
      container_network_receive_bytes_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_network_receive_bytes_total:labeled
  - expr: |
      container_network_transmit_bytes_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_network_transmit_bytes_total:labeled
  - expr: |
      container_spec_cpu_period{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_spec_cpu_period:labeled
  - expr: |
      container_spec_cpu_quota{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_spec_cpu_quota:labeled
  - expr: |
      container_spec_cpu_shares{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_spec_cpu_shares:labeled
  - expr: |
      container_spec_memory_limit_bytes{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: container_spec_memory_limit_bytes:labeled
  - expr: |
      kube_pod_container_resource_limits
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_resource_limits:labeled
  - expr: |
      kube_pod_container_resource_requests
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_resource_requests:labeled
  - expr: |
      kube_pod_container_status_last_terminated_reason
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_status_last_terminated_reason:labeled
  - expr: |
      kube_pod_container_status_ready
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_status_ready:labeled
  - expr: |
      kube_pod_container_status_restarts_total
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_status_restarts_total:labeled
  - expr: |
      kube_pod_container_status_running
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_status_running:labeled
  - expr: |
      kube_pod_container_status_terminated
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_status_terminated:labeled
  - expr: |
      kube_pod_container_status_terminated_reason
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_status_terminated_reason:labeled
  - expr: |
      kube_pod_container_status_waiting
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_status_waiting:labeled
  - expr: |
      kube_pod_container_status_waiting_reason
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_pod_container_status_waiting_reason:labeled
  - expr: |
      kube_horizontalpodautoscaler_spec_target_metric
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_horizontalpodautoscaler_spec_target_metric:labeled
  - expr: |
      kube_horizontalpodautoscaler_status_condition
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_horizontalpodautoscaler_status_condition:labeled
  - expr: |
      kube_horizontalpodautoscaler_status_current_replicas
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_horizontalpodautoscaler_status_current_replicas:labeled
  - expr: |
      kube_horizontalpodautoscaler_status_desired_replicas
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_horizontalpodautoscaler_status_desired_replicas:labeled
  - expr: |
      kube_horizontalpodautoscaler_metadata_generation
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_horizontalpodautoscaler_metadata_generation:labeled
  - expr: |
      kube_horizontalpodautoscaler_spec_max_replicas
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_horizontalpodautoscaler_spec_max_replicas:labeled
  - expr: |
      kube_horizontalpodautoscaler_spec_min_replicas
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_horizontalpodautoscaler_spec_min_replicas:labeled
  - expr: |
      kube_node_status_capacity
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_node_status_capacity:labeled
  - expr: |
      kube_node_status_allocatable
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_node_status_allocatable:labeled
  - expr: |
      kube_node_status_condition
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_node_status_condition:labeled
  - expr: |
      node_schedstat_waiting_seconds_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_schedstat_waiting_seconds_total:labeled
  - expr: |
      node_cpu_seconds_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_cpu_seconds_total:labeled
  - expr: |
      node_network_transmit_bytes_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_network_transmit_bytes_total:labeled
  - expr: |
      node_network_receive_bytes_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_network_receive_bytes_total:labeled
  - expr: |
      node_disk_reads_completed_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_disk_reads_completed_total:labeled
  - expr: |
      node_disk_writes_completed_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_disk_writes_completed_total:labeled
  - expr: |
      node_disk_read_bytes_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_disk_read_bytes_total:labeled
  - expr: |
      node_disk_written_bytes_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_disk_written_bytes_total:labeled
  - expr: |
      node_disk_read_time_seconds_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_disk_read_time_seconds_total:labeled
  - expr: |
      node_disk_write_time_seconds_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_disk_write_time_seconds_total:labeled
  - expr: |
      node_load1
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_load1:labeled
  - expr: |
      node_load5
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_load5:labeled
  - expr: |
      node_load15
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_load15:labeled
  - expr: |
      node_vmstat_oom_kill
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: node_vmstat_oom_kill:labeled
  - expr: |
      nginx_ingress_controller_requests
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: nginx_ingress_controller_requests:labeled
  - expr: |
      kube_deployment_status_replicas_unavailable
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_status_replicas_unavailable:labeled
  - expr: |
      kube_deployment_status_replicas_updated
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_status_replicas_updated:labeled
  - expr: |
      kube_deployment_spec_paused
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_spec_paused:labeled
  - expr: |
      kube_deployment_spec_replicas
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_spec_replicas:labeled
  - expr: |
      kube_deployment_spec_strategy_rollingupdate_max_surge
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_spec_strategy_rollingupdate_max_surge:labeled
  - expr: |
      kube_deployment_spec_strategy_rollingupdate_max_unavailable
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_spec_strategy_rollingupdate_max_unavailable:labeled
  - expr: |
      kube_deployment_status_condition
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_status_condition:labeled
  - expr: |
      kube_deployment_status_replicas_available
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_status_replicas_available:labeled
  - expr: |
      kube_deployment_created
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_created:labeled
  - expr: |
      kube_deployment_metadata_generation
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_metadata_generation:labeled
  - expr: |
      kube_deployment_status_observed_generation
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_status_observed_generation:labeled
  - expr: |
      kube_deployment_status_replicas
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type=~"consul|gitlab-shell|registry|sidekiq|webservice"})
    record: kube_deployment_status_replicas:labeled
