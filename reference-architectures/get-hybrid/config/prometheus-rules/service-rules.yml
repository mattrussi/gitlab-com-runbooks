# WARNING. DO NOT EDIT THIS FILE BY HAND. RUN ./scripts/generate-all-reference-architecture-configs.sh TO GENERATE IT. YOUR CHANGES WILL BE OVERRIDDEN
groups:
- interval: 1m
  name: 'Component-Level SLIs: consul - 5m burn-rate'
  rules: []
- interval: 2m
  name: 'Component-Level SLIs: consul - 30m burn-rate'
  rules: []
- interval: 1m
  name: 'Component-Level SLIs: consul - 1h burn-rate'
  rules: []
- interval: 2m
  name: 'Component-Level SLIs: consul - 6h burn-rate'
  rules: []
- interval: 1m
  name: 'Component mapping: consul'
  rules: []
- interval: 1m
  name: 'Component-Level SLIs: gitaly - 5m burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="0.5"}[5m])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="1"}[5m])
        )
      )
      /
      2
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="+Inf"}[5m])
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(gitaly_service_client_requests_total{grpc_service!="gitaly.OperationService",job="gitaly"}[5m])
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          label_replace(rate(gitaly_service_client_requests_total{grpc_code!~"AlreadyExists|Canceled|DeadlineExceeded|FailedPrecondition|InvalidArgument|NotFound|OK|PermissionDenied|ResourceExhausted|Unauthenticated",grpc_service!="gitaly.OperationService",job="gitaly"}[5m]), "_c", "0", "", "")
          or
          label_replace(rate(gitaly_service_client_requests_total{deadline_type!="limited",grpc_code="DeadlineExceeded",grpc_service!="gitaly.OperationService",job="gitaly"}[5m]), "_c", "1", "", "")
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"}
        )
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="goserver",tier="stor",type="gitaly"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"}
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="goserver",tier="stor",type="gitaly"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="goserver",tier="stor",type="gitaly"}
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"}) * (1 - (gitlab_component_errors:rate_5m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="goserver",tier="stor",type="gitaly"} * 300)),
        0, 1
      )
    labels:
      component: goserver
      confidence: 98%
      tier: stor
      type: gitaly
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="goserver",tier="stor",type="gitaly"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_5m{component="goserver",tier="stor",type="gitaly"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="goserver",tier="stor",type="gitaly"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_5m{component="goserver",tier="stor",type="gitaly"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_5m{component="goserver",tier="stor",type="gitaly"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="goserver",tier="stor",type="gitaly"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="goserver",tier="stor",type="gitaly"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="goserver",tier="stor",type="gitaly"} * 300)),
        0, 1
      )
    labels:
      component: goserver
      confidence: 98%
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:confidence:ratio_5m
- interval: 2m
  name: 'Component-Level SLIs: gitaly - 30m burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="0.5"}[30m])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="1"}[30m])
        )
      )
      /
      2
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="+Inf"}[30m])
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(gitaly_service_client_requests_total{grpc_service!="gitaly.OperationService",job="gitaly"}[30m])
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          label_replace(rate(gitaly_service_client_requests_total{grpc_code!~"AlreadyExists|Canceled|DeadlineExceeded|FailedPrecondition|InvalidArgument|NotFound|OK|PermissionDenied|ResourceExhausted|Unauthenticated",grpc_service!="gitaly.OperationService",job="gitaly"}[30m]), "_c", "0", "", "")
          or
          label_replace(rate(gitaly_service_client_requests_total{deadline_type!="limited",grpc_code="DeadlineExceeded",grpc_service!="gitaly.OperationService",job="gitaly"}[30m]), "_c", "1", "", "")
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"}
        )
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="goserver",tier="stor",type="gitaly"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"}
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="goserver",tier="stor",type="gitaly"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="goserver",tier="stor",type="gitaly"}
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"}) * (1 - (gitlab_component_errors:rate_30m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="goserver",tier="stor",type="gitaly"} * 1800)),
        0, 1
      )
    labels:
      component: goserver
      confidence: 98%
      tier: stor
      type: gitaly
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="goserver",tier="stor",type="gitaly"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_30m{component="goserver",tier="stor",type="gitaly"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="goserver",tier="stor",type="gitaly"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_30m{component="goserver",tier="stor",type="gitaly"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_30m{component="goserver",tier="stor",type="gitaly"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="goserver",tier="stor",type="gitaly"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="goserver",tier="stor",type="gitaly"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="goserver",tier="stor",type="gitaly"} * 1800)),
        0, 1
      )
    labels:
      component: goserver
      confidence: 98%
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:confidence:ratio_30m
- interval: 1m
  name: 'Component-Level SLIs: gitaly - 1h burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="0.5"}[1h])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="1"}[1h])
        )
      )
      /
      2
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="+Inf"}[1h])
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(gitaly_service_client_requests_total{grpc_service!="gitaly.OperationService",job="gitaly"}[1h])
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          label_replace(rate(gitaly_service_client_requests_total{grpc_code!~"AlreadyExists|Canceled|DeadlineExceeded|FailedPrecondition|InvalidArgument|NotFound|OK|PermissionDenied|ResourceExhausted|Unauthenticated",grpc_service!="gitaly.OperationService",job="gitaly"}[1h]), "_c", "0", "", "")
          or
          label_replace(rate(gitaly_service_client_requests_total{deadline_type!="limited",grpc_code="DeadlineExceeded",grpc_service!="gitaly.OperationService",job="gitaly"}[1h]), "_c", "1", "", "")
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"}
        )
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="goserver",tier="stor",type="gitaly"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"}
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="goserver",tier="stor",type="gitaly"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="goserver",tier="stor",type="gitaly"}
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"}) * (1 - (gitlab_component_errors:rate_1h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="goserver",tier="stor",type="gitaly"} * 3600)),
        0, 1
      )
    labels:
      component: goserver
      confidence: 98%
      tier: stor
      type: gitaly
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="goserver",tier="stor",type="gitaly"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_1h{component="goserver",tier="stor",type="gitaly"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="goserver",tier="stor",type="gitaly"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_1h{component="goserver",tier="stor",type="gitaly"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_1h{component="goserver",tier="stor",type="gitaly"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="goserver",tier="stor",type="gitaly"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="goserver",tier="stor",type="gitaly"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="goserver",tier="stor",type="gitaly"} * 3600)),
        0, 1
      )
    labels:
      component: goserver
      confidence: 98%
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:confidence:ratio_1h
- interval: 2m
  name: 'Component-Level SLIs: gitaly - 6h burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="0.5"}[6h])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="1"}[6h])
        )
      )
      /
      2
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_method!~"CalculateChecksum|CommitLanguages|CommitStats|CreateFork|CreateRepositoryFromURL|FetchInternalRemote|FetchIntoObjectPool|FetchRemote|FetchSourceBranch|FindRemoteRepository|FindRemoteRootRef|Fsck|GarbageCollect|OptimizeRepository|PackObjectsHookWithSidechannel|PostReceiveHook|PostUploadPackWithSidechannel|PreReceiveHook|RepackFull|RepackIncremental|ReplicateRepository|RepositorySize|SSHUploadPackWithSidechannel|UpdateHook",grpc_service!="gitaly.OperationService",grpc_type="unary",job="gitaly",le="+Inf"}[6h])
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(gitaly_service_client_requests_total{grpc_service!="gitaly.OperationService",job="gitaly"}[6h])
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          label_replace(rate(gitaly_service_client_requests_total{grpc_code!~"AlreadyExists|Canceled|DeadlineExceeded|FailedPrecondition|InvalidArgument|NotFound|OK|PermissionDenied|ResourceExhausted|Unauthenticated",grpc_service!="gitaly.OperationService",job="gitaly"}[6h]), "_c", "0", "", "")
          or
          label_replace(rate(gitaly_service_client_requests_total{deadline_type!="limited",grpc_code="DeadlineExceeded",grpc_service!="gitaly.OperationService",job="gitaly"}[6h]), "_c", "1", "", "")
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"}
        )
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="goserver",tier="stor",type="gitaly"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"}
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="goserver",tier="stor",type="gitaly"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="goserver",tier="stor",type="gitaly"}
      )
    labels:
      component: goserver
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"}) * (1 - (gitlab_component_errors:rate_6h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="goserver",tier="stor",type="gitaly"} * 21600)),
        0, 1
      )
    labels:
      component: goserver
      confidence: 98%
      tier: stor
      type: gitaly
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="goserver",tier="stor",type="gitaly"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_6h{component="goserver",tier="stor",type="gitaly"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="goserver",tier="stor",type="gitaly"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_6h{component="goserver",tier="stor",type="gitaly"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="goserver",tier="stor",type="gitaly"} / gitlab_component_apdex:weight:score_6h{component="goserver",tier="stor",type="gitaly"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="goserver",tier="stor",type="gitaly"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="goserver",tier="stor",type="gitaly"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="goserver",tier="stor",type="gitaly"} * 21600)),
        0, 1
      )
    labels:
      component: goserver
      confidence: 98%
      tier: stor
      type: gitaly
    record: gitlab_component_apdex:confidence:ratio_6h
- interval: 1m
  name: 'Component mapping: gitaly'
  rules:
  - expr: "1"
    labels:
      component: goserver
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: stor
      type: gitaly
    record: gitlab_component_service:mapping
- interval: 1m
  name: 'Component-Level SLIs: gitlab-shell - 5m burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="30"}[5m])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="60"}[5m])
        )
      )
      /
      2
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="+Inf"}[5m])
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(gitaly_service_client_requests_total{grpc_service="gitaly.SSHService",job="gitaly"}[5m])
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(grpc_server_handled_total{grpc_code!~"AlreadyExists|Canceled|DeadlineExceeded|FailedPrecondition|InvalidArgument|NotFound|OK|PermissionDenied|ResourceExhausted|Unauthenticated",grpc_service="gitaly.SSHService",job="gitaly"}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"}
        )
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"}) * (1 - (gitlab_component_errors:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 300)),
        0, 1
      )
    labels:
      component: grpc_requests
      confidence: 98%
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_5m{component="grpc_requests",tier="sv",type="gitlab-shell"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_5m{component="grpc_requests",tier="sv",type="gitlab-shell"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_5m{component="grpc_requests",tier="sv",type="gitlab-shell"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 300)),
        0, 1
      )
    labels:
      component: grpc_requests
      confidence: 98%
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:confidence:ratio_5m
- interval: 2m
  name: 'Component-Level SLIs: gitlab-shell - 30m burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="30"}[30m])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="60"}[30m])
        )
      )
      /
      2
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="+Inf"}[30m])
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(gitaly_service_client_requests_total{grpc_service="gitaly.SSHService",job="gitaly"}[30m])
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(grpc_server_handled_total{grpc_code!~"AlreadyExists|Canceled|DeadlineExceeded|FailedPrecondition|InvalidArgument|NotFound|OK|PermissionDenied|ResourceExhausted|Unauthenticated",grpc_service="gitaly.SSHService",job="gitaly"}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"}
        )
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"}) * (1 - (gitlab_component_errors:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 1800)),
        0, 1
      )
    labels:
      component: grpc_requests
      confidence: 98%
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_30m{component="grpc_requests",tier="sv",type="gitlab-shell"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_30m{component="grpc_requests",tier="sv",type="gitlab-shell"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_30m{component="grpc_requests",tier="sv",type="gitlab-shell"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="grpc_requests",tier="sv",type="gitlab-shell"} * 1800)),
        0, 1
      )
    labels:
      component: grpc_requests
      confidence: 98%
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:confidence:ratio_30m
- interval: 1m
  name: 'Component-Level SLIs: gitlab-shell - 1h burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="30"}[1h])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="60"}[1h])
        )
      )
      /
      2
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="+Inf"}[1h])
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(gitaly_service_client_requests_total{grpc_service="gitaly.SSHService",job="gitaly"}[1h])
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(grpc_server_handled_total{grpc_code!~"AlreadyExists|Canceled|DeadlineExceeded|FailedPrecondition|InvalidArgument|NotFound|OK|PermissionDenied|ResourceExhausted|Unauthenticated",grpc_service="gitaly.SSHService",job="gitaly"}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"}
        )
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"}) * (1 - (gitlab_component_errors:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 3600)),
        0, 1
      )
    labels:
      component: grpc_requests
      confidence: 98%
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_1h{component="grpc_requests",tier="sv",type="gitlab-shell"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_1h{component="grpc_requests",tier="sv",type="gitlab-shell"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_1h{component="grpc_requests",tier="sv",type="gitlab-shell"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 3600)),
        0, 1
      )
    labels:
      component: grpc_requests
      confidence: 98%
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:confidence:ratio_1h
- interval: 2m
  name: 'Component-Level SLIs: gitlab-shell - 6h burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="30"}[6h])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="60"}[6h])
        )
      )
      /
      2
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_service="gitaly.SSHService",grpc_type="unary",job="gitaly",le="+Inf"}[6h])
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(gitaly_service_client_requests_total{grpc_service="gitaly.SSHService",job="gitaly"}[6h])
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(grpc_server_handled_total{grpc_code!~"AlreadyExists|Canceled|DeadlineExceeded|FailedPrecondition|InvalidArgument|NotFound|OK|PermissionDenied|ResourceExhausted|Unauthenticated",grpc_service="gitaly.SSHService",job="gitaly"}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"}
        )
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="grpc_requests",tier="sv",type="gitlab-shell"}
      )
    labels:
      component: grpc_requests
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"}) * (1 - (gitlab_component_errors:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 21600)),
        0, 1
      )
    labels:
      component: grpc_requests
      confidence: 98%
      tier: sv
      type: gitlab-shell
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_6h{component="grpc_requests",tier="sv",type="gitlab-shell"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_6h{component="grpc_requests",tier="sv",type="gitlab-shell"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} / gitlab_component_apdex:weight:score_6h{component="grpc_requests",tier="sv",type="gitlab-shell"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="grpc_requests",tier="sv",type="gitlab-shell"} * 21600)),
        0, 1
      )
    labels:
      component: grpc_requests
      confidence: 98%
      tier: sv
      type: gitlab-shell
    record: gitlab_component_apdex:confidence:ratio_6h
- interval: 1m
  name: 'Component mapping: gitlab-shell'
  rules:
  - expr: "1"
    labels:
      component: grpc_requests
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: gitlab-shell
    record: gitlab_component_service:mapping
- interval: 1m
  name: 'Component-Level SLIs: kube - 5m burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(apiserver_request_duration_seconds_bucket{job="apiserver",le="1",scope!="",verb!~"^(?:CONNECT|WATCHLIST|WATCH|PROXY)$"}[5m])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(apiserver_request_duration_seconds_bucket{job="apiserver",le="+Inf",scope!="",verb!~"^(?:CONNECT|WATCHLIST|WATCH|PROXY)$"}[5m])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(apiserver_request_total{job="apiserver",scope!=""}[5m])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(apiserver_request_total{code=~"5..",job="apiserver",scope!=""}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="apiserver",tier="inf",type="kube"}
        )
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="apiserver",tier="inf",type="kube"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="apiserver",tier="inf",type="kube"}
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="apiserver",tier="inf",type="kube"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="apiserver",tier="inf",type="kube"}
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:ratio_5m
- interval: 2m
  name: 'Component-Level SLIs: kube - 30m burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(apiserver_request_duration_seconds_bucket{job="apiserver",le="1",scope!="",verb!~"^(?:CONNECT|WATCHLIST|WATCH|PROXY)$"}[30m])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(apiserver_request_duration_seconds_bucket{job="apiserver",le="+Inf",scope!="",verb!~"^(?:CONNECT|WATCHLIST|WATCH|PROXY)$"}[30m])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(apiserver_request_total{job="apiserver",scope!=""}[30m])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(apiserver_request_total{code=~"5..",job="apiserver",scope!=""}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="apiserver",tier="inf",type="kube"}
        )
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="apiserver",tier="inf",type="kube"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="apiserver",tier="inf",type="kube"}
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="apiserver",tier="inf",type="kube"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="apiserver",tier="inf",type="kube"}
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:ratio_30m
- interval: 1m
  name: 'Component-Level SLIs: kube - 1h burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(apiserver_request_duration_seconds_bucket{job="apiserver",le="1",scope!="",verb!~"^(?:CONNECT|WATCHLIST|WATCH|PROXY)$"}[1h])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(apiserver_request_duration_seconds_bucket{job="apiserver",le="+Inf",scope!="",verb!~"^(?:CONNECT|WATCHLIST|WATCH|PROXY)$"}[1h])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(apiserver_request_total{job="apiserver",scope!=""}[1h])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(apiserver_request_total{code=~"5..",job="apiserver",scope!=""}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="apiserver",tier="inf",type="kube"}
        )
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="apiserver",tier="inf",type="kube"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="apiserver",tier="inf",type="kube"}
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="apiserver",tier="inf",type="kube"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="apiserver",tier="inf",type="kube"}
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:ratio_1h
- interval: 2m
  name: 'Component-Level SLIs: kube - 6h burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(apiserver_request_duration_seconds_bucket{job="apiserver",le="1",scope!="",verb!~"^(?:CONNECT|WATCHLIST|WATCH|PROXY)$"}[6h])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(apiserver_request_duration_seconds_bucket{job="apiserver",le="+Inf",scope!="",verb!~"^(?:CONNECT|WATCHLIST|WATCH|PROXY)$"}[6h])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(apiserver_request_total{job="apiserver",scope!=""}[6h])
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(apiserver_request_total{code=~"5..",job="apiserver",scope!=""}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="apiserver",tier="inf",type="kube"}
        )
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="apiserver",tier="inf",type="kube"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="apiserver",tier="inf",type="kube"}
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="apiserver",tier="inf",type="kube"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="apiserver",tier="inf",type="kube"}
      )
    labels:
      component: apiserver
      tier: inf
      type: kube
    record: gitlab_component_apdex:ratio_6h
- interval: 1m
  name: 'Component mapping: kube'
  rules:
  - expr: "1"
    labels:
      component: apiserver
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: inf
      type: kube
    record: gitlab_component_service:mapping
- interval: 1m
  name: 'Component-Level SLIs: praefect - 5m burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="0.5"}[5m])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="1"}[5m])
        )
      )
      /
      2
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="+Inf"}[5m])
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(grpc_server_handled_total{job="praefect"}[5m])
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(grpc_server_handled_total{grpc_code!~"^(OK|NotFound|Unauthenticated|AlreadyExists|FailedPrecondition|Canceled)$",job="praefect"}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"}
        )
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="proxy",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"}
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="proxy",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="proxy",tier="stor",type="praefect"}
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"}) * (1 - (gitlab_component_errors:rate_5m{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="proxy",tier="stor",type="praefect"} * 300)),
        0, 1
      )
    labels:
      component: proxy
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="proxy",tier="stor",type="praefect"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_5m{component="proxy",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="proxy",tier="stor",type="praefect"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_5m{component="proxy",tier="stor",type="praefect"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_5m{component="proxy",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="proxy",tier="stor",type="praefect"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="proxy",tier="stor",type="praefect"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="proxy",tier="stor",type="praefect"} * 300)),
        0, 1
      )
    labels:
      component: proxy
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="300"}[5m])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="+Inf"}[5m])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="+Inf"}[5m])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_ops:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="replicator_queue",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="replicator_queue",tier="stor",type="praefect"}
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="replicator_queue",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="replicator_queue",tier="stor",type="praefect"}
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="replicator_queue",tier="stor",type="praefect"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_5m{component="replicator_queue",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="replicator_queue",tier="stor",type="praefect"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_5m{component="replicator_queue",tier="stor",type="praefect"}) * (1 - (gitlab_component_errors:rate_5m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_5m{component="replicator_queue",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="replicator_queue",tier="stor",type="praefect"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="replicator_queue",tier="stor",type="praefect"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="replicator_queue",tier="stor",type="praefect"} * 300)),
        0, 1
      )
    labels:
      component: replicator_queue
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="replicator_queue",tier="stor",type="praefect"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_5m{component="replicator_queue",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="replicator_queue",tier="stor",type="praefect"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_5m{component="replicator_queue",tier="stor",type="praefect"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_5m{component="replicator_queue",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="replicator_queue",tier="stor",type="praefect"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="replicator_queue",tier="stor",type="praefect"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="replicator_queue",tier="stor",type="praefect"} * 300)),
        0, 1
      )
    labels:
      component: replicator_queue
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_apdex:confidence:ratio_5m
- interval: 2m
  name: 'Component-Level SLIs: praefect - 30m burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="0.5"}[30m])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="1"}[30m])
        )
      )
      /
      2
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="+Inf"}[30m])
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(grpc_server_handled_total{job="praefect"}[30m])
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(grpc_server_handled_total{grpc_code!~"^(OK|NotFound|Unauthenticated|AlreadyExists|FailedPrecondition|Canceled)$",job="praefect"}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"}
        )
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="proxy",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"}
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="proxy",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="proxy",tier="stor",type="praefect"}
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"}) * (1 - (gitlab_component_errors:rate_30m{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="proxy",tier="stor",type="praefect"} * 1800)),
        0, 1
      )
    labels:
      component: proxy
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="proxy",tier="stor",type="praefect"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_30m{component="proxy",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="proxy",tier="stor",type="praefect"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_30m{component="proxy",tier="stor",type="praefect"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_30m{component="proxy",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="proxy",tier="stor",type="praefect"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="proxy",tier="stor",type="praefect"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="proxy",tier="stor",type="praefect"} * 1800)),
        0, 1
      )
    labels:
      component: proxy
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="300"}[30m])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="+Inf"}[30m])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="+Inf"}[30m])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_ops:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="replicator_queue",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="replicator_queue",tier="stor",type="praefect"}
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="replicator_queue",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="replicator_queue",tier="stor",type="praefect"}
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="replicator_queue",tier="stor",type="praefect"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_30m{component="replicator_queue",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="replicator_queue",tier="stor",type="praefect"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_30m{component="replicator_queue",tier="stor",type="praefect"}) * (1 - (gitlab_component_errors:rate_30m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_30m{component="replicator_queue",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="replicator_queue",tier="stor",type="praefect"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="replicator_queue",tier="stor",type="praefect"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="replicator_queue",tier="stor",type="praefect"} * 1800)),
        0, 1
      )
    labels:
      component: replicator_queue
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="replicator_queue",tier="stor",type="praefect"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_30m{component="replicator_queue",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="replicator_queue",tier="stor",type="praefect"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_30m{component="replicator_queue",tier="stor",type="praefect"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_30m{component="replicator_queue",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="replicator_queue",tier="stor",type="praefect"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="replicator_queue",tier="stor",type="praefect"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="replicator_queue",tier="stor",type="praefect"} * 1800)),
        0, 1
      )
    labels:
      component: replicator_queue
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_apdex:confidence:ratio_30m
- interval: 1m
  name: 'Component-Level SLIs: praefect - 1h burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="0.5"}[1h])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="1"}[1h])
        )
      )
      /
      2
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="+Inf"}[1h])
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(grpc_server_handled_total{job="praefect"}[1h])
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(grpc_server_handled_total{grpc_code!~"^(OK|NotFound|Unauthenticated|AlreadyExists|FailedPrecondition|Canceled)$",job="praefect"}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"}
        )
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="proxy",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"}
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="proxy",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="proxy",tier="stor",type="praefect"}
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"}) * (1 - (gitlab_component_errors:rate_1h{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="proxy",tier="stor",type="praefect"} * 3600)),
        0, 1
      )
    labels:
      component: proxy
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="proxy",tier="stor",type="praefect"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_1h{component="proxy",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="proxy",tier="stor",type="praefect"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_1h{component="proxy",tier="stor",type="praefect"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_1h{component="proxy",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="proxy",tier="stor",type="praefect"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="proxy",tier="stor",type="praefect"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="proxy",tier="stor",type="praefect"} * 3600)),
        0, 1
      )
    labels:
      component: proxy
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="300"}[1h])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="+Inf"}[1h])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="+Inf"}[1h])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_ops:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="replicator_queue",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="replicator_queue",tier="stor",type="praefect"}
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="replicator_queue",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="replicator_queue",tier="stor",type="praefect"}
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="replicator_queue",tier="stor",type="praefect"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_1h{component="replicator_queue",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="replicator_queue",tier="stor",type="praefect"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_1h{component="replicator_queue",tier="stor",type="praefect"}) * (1 - (gitlab_component_errors:rate_1h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_1h{component="replicator_queue",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="replicator_queue",tier="stor",type="praefect"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="replicator_queue",tier="stor",type="praefect"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="replicator_queue",tier="stor",type="praefect"} * 3600)),
        0, 1
      )
    labels:
      component: replicator_queue
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="replicator_queue",tier="stor",type="praefect"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_1h{component="replicator_queue",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="replicator_queue",tier="stor",type="praefect"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_1h{component="replicator_queue",tier="stor",type="praefect"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_1h{component="replicator_queue",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="replicator_queue",tier="stor",type="praefect"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="replicator_queue",tier="stor",type="praefect"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="replicator_queue",tier="stor",type="praefect"} * 3600)),
        0, 1
      )
    labels:
      component: replicator_queue
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_apdex:confidence:ratio_1h
- interval: 2m
  name: 'Component-Level SLIs: praefect - 6h burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="0.5"}[6h])
        )
        +
        sum by () (
          rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="1"}[6h])
        )
      )
      /
      2
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(grpc_server_handling_seconds_bucket{grpc_type="unary",job="praefect",le="+Inf"}[6h])
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(grpc_server_handled_total{job="praefect"}[6h])
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(grpc_server_handled_total{grpc_code!~"^(OK|NotFound|Unauthenticated|AlreadyExists|FailedPrecondition|Canceled)$",job="praefect"}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"}
        )
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="proxy",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"}
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="proxy",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="proxy",tier="stor",type="praefect"}
      )
    labels:
      component: proxy
      tier: stor
      type: praefect
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"}) * (1 - (gitlab_component_errors:rate_6h{component="proxy",tier="stor",type="praefect"} / gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="proxy",tier="stor",type="praefect"} * 21600)),
        0, 1
      )
    labels:
      component: proxy
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="proxy",tier="stor",type="praefect"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_6h{component="proxy",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="proxy",tier="stor",type="praefect"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_6h{component="proxy",tier="stor",type="praefect"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="proxy",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_6h{component="proxy",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="proxy",tier="stor",type="praefect"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="proxy",tier="stor",type="praefect"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="proxy",tier="stor",type="praefect"} * 21600)),
        0, 1
      )
    labels:
      component: proxy
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="300"}[6h])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="+Inf"}[6h])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(gitaly_praefect_replication_delay_bucket{le="+Inf"}[6h])
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_ops:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="replicator_queue",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="replicator_queue",tier="stor",type="praefect"}
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="replicator_queue",tier="stor",type="praefect"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="replicator_queue",tier="stor",type="praefect"}
      )
    labels:
      component: replicator_queue
      tier: stor
      type: praefect
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="replicator_queue",tier="stor",type="praefect"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_6h{component="replicator_queue",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="replicator_queue",tier="stor",type="praefect"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_6h{component="replicator_queue",tier="stor",type="praefect"}) * (1 - (gitlab_component_errors:rate_6h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_ops:rate_6h{component="replicator_queue",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="replicator_queue",tier="stor",type="praefect"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="replicator_queue",tier="stor",type="praefect"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="replicator_queue",tier="stor",type="praefect"} * 21600)),
        0, 1
      )
    labels:
      component: replicator_queue
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="replicator_queue",tier="stor",type="praefect"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_6h{component="replicator_queue",tier="stor",type="praefect"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="replicator_queue",tier="stor",type="praefect"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_6h{component="replicator_queue",tier="stor",type="praefect"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="replicator_queue",tier="stor",type="praefect"} / gitlab_component_apdex:weight:score_6h{component="replicator_queue",tier="stor",type="praefect"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="replicator_queue",tier="stor",type="praefect"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="replicator_queue",tier="stor",type="praefect"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="replicator_queue",tier="stor",type="praefect"} * 21600)),
        0, 1
      )
    labels:
      component: replicator_queue
      confidence: 98%
      tier: stor
      type: praefect
    record: gitlab_component_apdex:confidence:ratio_6h
- interval: 1m
  name: 'Component mapping: praefect'
  rules:
  - expr: "1"
    labels:
      component: proxy
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: stor
      type: praefect
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: replicator_queue
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: stor
      type: praefect
    record: gitlab_component_service:mapping
- interval: 1m
  name: 'Component-Level SLIs: redis - 5m burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(redis_commands_processed_total{type="redis"}[5m]) and on (instance) redis_instance_info{role="master"}
      )
    labels:
      component: primary_server
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="primary_server",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="primary_server",tier="db",type="redis"}
      )
    labels:
      component: primary_server
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="primary_server",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="primary_server",tier="db",type="redis"}
      )
    labels:
      component: primary_server
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="primary_server",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_5m{component="primary_server",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="primary_server",tier="db",type="redis"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_5m{component="primary_server",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_5m{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_5m{component="primary_server",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="primary_server",tier="db",type="redis"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="primary_server",tier="db",type="redis"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="primary_server",tier="db",type="redis"} * 300)),
        0, 1
      )
    labels:
      component: primary_server
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="primary_server",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_5m{component="primary_server",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="primary_server",tier="db",type="redis"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_5m{component="primary_server",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_5m{component="primary_server",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="primary_server",tier="db",type="redis"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="primary_server",tier="db",type="redis"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="primary_server",tier="db",type="redis"} * 300)),
        0, 1
      )
    labels:
      component: primary_server
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_redis_client_requests_duration_seconds_bucket{le="0.5"}[5m])
        )
        +
        sum by () (
          rate(gitlab_redis_client_requests_duration_seconds_bucket{le="0.75"}[5m])
        )
      )
      /
      2
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(gitlab_redis_client_requests_duration_seconds_bucket{le="+Inf"}[5m])
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(gitlab_redis_client_requests_total{}[5m])
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_redis_client_exceptions_total{}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="rails_redis_client",stage="main",tier="db",type="redis"}
        )
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="rails_redis_client",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="rails_redis_client",tier="db",type="redis"}
      )
    labels:
      component: rails_redis_client
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="rails_redis_client",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="rails_redis_client",tier="db",type="redis"}
      )
    labels:
      component: rails_redis_client
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="rails_redis_client",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_5m{component="rails_redis_client",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="rails_redis_client",tier="db",type="redis"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_5m{component="rails_redis_client",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_5m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_5m{component="rails_redis_client",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="rails_redis_client",tier="db",type="redis"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="rails_redis_client",tier="db",type="redis"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="rails_redis_client",tier="db",type="redis"} * 300)),
        0, 1
      )
    labels:
      component: rails_redis_client
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="rails_redis_client",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_5m{component="rails_redis_client",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="rails_redis_client",tier="db",type="redis"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_5m{component="rails_redis_client",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_5m{component="rails_redis_client",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="rails_redis_client",tier="db",type="redis"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="rails_redis_client",tier="db",type="redis"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="rails_redis_client",tier="db",type="redis"} * 300)),
        0, 1
      )
    labels:
      component: rails_redis_client
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_cache_operation_duration_seconds_bucket{le="0.1"}[5m])
        )
        +
        sum by () (
          rate(gitlab_cache_operation_duration_seconds_bucket{le="0.25"}[5m])
        )
      )
      /
      2
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(gitlab_cache_operation_duration_seconds_bucket{le="+Inf"}[5m])
      )
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(gitlab_cache_operation_duration_seconds_count{}[5m])
      )
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="redis",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="redis",tier="db",type="redis"}
      )
    labels:
      component: redis
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="redis",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="redis",tier="db",type="redis"}
      )
    labels:
      component: redis
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="redis",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_5m{component="redis",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="redis",tier="db",type="redis"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_5m{component="redis",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_5m{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_5m{component="redis",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="redis",tier="db",type="redis"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="redis",tier="db",type="redis"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="redis",tier="db",type="redis"} * 300)),
        0, 1
      )
    labels:
      component: redis
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="redis",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_5m{component="redis",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="redis",tier="db",type="redis"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_5m{component="redis",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_5m{component="redis",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="redis",tier="db",type="redis"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="redis",tier="db",type="redis"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="redis",tier="db",type="redis"} * 300)),
        0, 1
      )
    labels:
      component: redis
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_5m
- interval: 2m
  name: 'Component-Level SLIs: redis - 30m burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(redis_commands_processed_total{type="redis"}[30m]) and on (instance) redis_instance_info{role="master"}
      )
    labels:
      component: primary_server
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="primary_server",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="primary_server",tier="db",type="redis"}
      )
    labels:
      component: primary_server
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="primary_server",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="primary_server",tier="db",type="redis"}
      )
    labels:
      component: primary_server
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="primary_server",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_30m{component="primary_server",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="primary_server",tier="db",type="redis"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_30m{component="primary_server",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_30m{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_30m{component="primary_server",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="primary_server",tier="db",type="redis"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="primary_server",tier="db",type="redis"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="primary_server",tier="db",type="redis"} * 1800)),
        0, 1
      )
    labels:
      component: primary_server
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="primary_server",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_30m{component="primary_server",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="primary_server",tier="db",type="redis"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_30m{component="primary_server",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_30m{component="primary_server",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="primary_server",tier="db",type="redis"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="primary_server",tier="db",type="redis"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="primary_server",tier="db",type="redis"} * 1800)),
        0, 1
      )
    labels:
      component: primary_server
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_redis_client_requests_duration_seconds_bucket{le="0.5"}[30m])
        )
        +
        sum by () (
          rate(gitlab_redis_client_requests_duration_seconds_bucket{le="0.75"}[30m])
        )
      )
      /
      2
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(gitlab_redis_client_requests_duration_seconds_bucket{le="+Inf"}[30m])
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(gitlab_redis_client_requests_total{}[30m])
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_redis_client_exceptions_total{}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="rails_redis_client",stage="main",tier="db",type="redis"}
        )
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="rails_redis_client",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="rails_redis_client",tier="db",type="redis"}
      )
    labels:
      component: rails_redis_client
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="rails_redis_client",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="rails_redis_client",tier="db",type="redis"}
      )
    labels:
      component: rails_redis_client
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="rails_redis_client",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_30m{component="rails_redis_client",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="rails_redis_client",tier="db",type="redis"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_30m{component="rails_redis_client",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_30m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_30m{component="rails_redis_client",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="rails_redis_client",tier="db",type="redis"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="rails_redis_client",tier="db",type="redis"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="rails_redis_client",tier="db",type="redis"} * 1800)),
        0, 1
      )
    labels:
      component: rails_redis_client
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="rails_redis_client",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_30m{component="rails_redis_client",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="rails_redis_client",tier="db",type="redis"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_30m{component="rails_redis_client",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_30m{component="rails_redis_client",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="rails_redis_client",tier="db",type="redis"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="rails_redis_client",tier="db",type="redis"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="rails_redis_client",tier="db",type="redis"} * 1800)),
        0, 1
      )
    labels:
      component: rails_redis_client
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_cache_operation_duration_seconds_bucket{le="0.1"}[30m])
        )
        +
        sum by () (
          rate(gitlab_cache_operation_duration_seconds_bucket{le="0.25"}[30m])
        )
      )
      /
      2
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(gitlab_cache_operation_duration_seconds_bucket{le="+Inf"}[30m])
      )
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(gitlab_cache_operation_duration_seconds_count{}[30m])
      )
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="redis",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="redis",tier="db",type="redis"}
      )
    labels:
      component: redis
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="redis",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="redis",tier="db",type="redis"}
      )
    labels:
      component: redis
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="redis",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_30m{component="redis",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="redis",tier="db",type="redis"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_30m{component="redis",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_30m{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_30m{component="redis",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="redis",tier="db",type="redis"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="redis",tier="db",type="redis"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="redis",tier="db",type="redis"} * 1800)),
        0, 1
      )
    labels:
      component: redis
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="redis",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_30m{component="redis",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="redis",tier="db",type="redis"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_30m{component="redis",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_30m{component="redis",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="redis",tier="db",type="redis"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="redis",tier="db",type="redis"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="redis",tier="db",type="redis"} * 1800)),
        0, 1
      )
    labels:
      component: redis
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_30m
- interval: 1m
  name: 'Component-Level SLIs: redis - 1h burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(redis_commands_processed_total{type="redis"}[1h]) and on (instance) redis_instance_info{role="master"}
      )
    labels:
      component: primary_server
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="primary_server",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="primary_server",tier="db",type="redis"}
      )
    labels:
      component: primary_server
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="primary_server",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="primary_server",tier="db",type="redis"}
      )
    labels:
      component: primary_server
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="primary_server",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_1h{component="primary_server",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="primary_server",tier="db",type="redis"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_1h{component="primary_server",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_1h{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_1h{component="primary_server",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="primary_server",tier="db",type="redis"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="primary_server",tier="db",type="redis"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="primary_server",tier="db",type="redis"} * 3600)),
        0, 1
      )
    labels:
      component: primary_server
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="primary_server",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_1h{component="primary_server",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="primary_server",tier="db",type="redis"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_1h{component="primary_server",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_1h{component="primary_server",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="primary_server",tier="db",type="redis"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="primary_server",tier="db",type="redis"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="primary_server",tier="db",type="redis"} * 3600)),
        0, 1
      )
    labels:
      component: primary_server
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_redis_client_requests_duration_seconds_bucket{le="0.5"}[1h])
        )
        +
        sum by () (
          rate(gitlab_redis_client_requests_duration_seconds_bucket{le="0.75"}[1h])
        )
      )
      /
      2
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(gitlab_redis_client_requests_duration_seconds_bucket{le="+Inf"}[1h])
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(gitlab_redis_client_requests_total{}[1h])
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_redis_client_exceptions_total{}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="rails_redis_client",stage="main",tier="db",type="redis"}
        )
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="rails_redis_client",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="rails_redis_client",tier="db",type="redis"}
      )
    labels:
      component: rails_redis_client
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="rails_redis_client",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="rails_redis_client",tier="db",type="redis"}
      )
    labels:
      component: rails_redis_client
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="rails_redis_client",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_1h{component="rails_redis_client",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="rails_redis_client",tier="db",type="redis"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_1h{component="rails_redis_client",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_1h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_1h{component="rails_redis_client",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="rails_redis_client",tier="db",type="redis"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="rails_redis_client",tier="db",type="redis"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="rails_redis_client",tier="db",type="redis"} * 3600)),
        0, 1
      )
    labels:
      component: rails_redis_client
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="rails_redis_client",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_1h{component="rails_redis_client",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="rails_redis_client",tier="db",type="redis"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_1h{component="rails_redis_client",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_1h{component="rails_redis_client",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="rails_redis_client",tier="db",type="redis"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="rails_redis_client",tier="db",type="redis"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="rails_redis_client",tier="db",type="redis"} * 3600)),
        0, 1
      )
    labels:
      component: rails_redis_client
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_cache_operation_duration_seconds_bucket{le="0.1"}[1h])
        )
        +
        sum by () (
          rate(gitlab_cache_operation_duration_seconds_bucket{le="0.25"}[1h])
        )
      )
      /
      2
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(gitlab_cache_operation_duration_seconds_bucket{le="+Inf"}[1h])
      )
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(gitlab_cache_operation_duration_seconds_count{}[1h])
      )
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="redis",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="redis",tier="db",type="redis"}
      )
    labels:
      component: redis
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="redis",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="redis",tier="db",type="redis"}
      )
    labels:
      component: redis
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="redis",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_1h{component="redis",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="redis",tier="db",type="redis"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_1h{component="redis",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_1h{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_1h{component="redis",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="redis",tier="db",type="redis"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="redis",tier="db",type="redis"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="redis",tier="db",type="redis"} * 3600)),
        0, 1
      )
    labels:
      component: redis
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="redis",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_1h{component="redis",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="redis",tier="db",type="redis"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_1h{component="redis",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_1h{component="redis",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="redis",tier="db",type="redis"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="redis",tier="db",type="redis"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="redis",tier="db",type="redis"} * 3600)),
        0, 1
      )
    labels:
      component: redis
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_1h
- interval: 2m
  name: 'Component-Level SLIs: redis - 6h burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(redis_commands_processed_total{type="redis"}[6h]) and on (instance) redis_instance_info{role="master"}
      )
    labels:
      component: primary_server
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="primary_server",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="primary_server",tier="db",type="redis"}
      )
    labels:
      component: primary_server
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="primary_server",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="primary_server",tier="db",type="redis"}
      )
    labels:
      component: primary_server
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="primary_server",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_6h{component="primary_server",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="primary_server",tier="db",type="redis"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_6h{component="primary_server",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_6h{component="primary_server",tier="db",type="redis"} / gitlab_component_ops:rate_6h{component="primary_server",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="primary_server",tier="db",type="redis"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="primary_server",tier="db",type="redis"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="primary_server",tier="db",type="redis"} * 21600)),
        0, 1
      )
    labels:
      component: primary_server
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="primary_server",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_6h{component="primary_server",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="primary_server",tier="db",type="redis"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_6h{component="primary_server",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="primary_server",tier="db",type="redis"} / gitlab_component_apdex:weight:score_6h{component="primary_server",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="primary_server",tier="db",type="redis"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="primary_server",tier="db",type="redis"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="primary_server",tier="db",type="redis"} * 21600)),
        0, 1
      )
    labels:
      component: primary_server
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_redis_client_requests_duration_seconds_bucket{le="0.5"}[6h])
        )
        +
        sum by () (
          rate(gitlab_redis_client_requests_duration_seconds_bucket{le="0.75"}[6h])
        )
      )
      /
      2
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(gitlab_redis_client_requests_duration_seconds_bucket{le="+Inf"}[6h])
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(gitlab_redis_client_requests_total{}[6h])
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_redis_client_exceptions_total{}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="rails_redis_client",stage="main",tier="db",type="redis"}
        )
      )
    labels:
      component: rails_redis_client
      stage: main
      tier: db
      type: redis
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="rails_redis_client",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="rails_redis_client",tier="db",type="redis"}
      )
    labels:
      component: rails_redis_client
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="rails_redis_client",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="rails_redis_client",tier="db",type="redis"}
      )
    labels:
      component: rails_redis_client
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="rails_redis_client",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_6h{component="rails_redis_client",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="rails_redis_client",tier="db",type="redis"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_6h{component="rails_redis_client",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_6h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_ops:rate_6h{component="rails_redis_client",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="rails_redis_client",tier="db",type="redis"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="rails_redis_client",tier="db",type="redis"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="rails_redis_client",tier="db",type="redis"} * 21600)),
        0, 1
      )
    labels:
      component: rails_redis_client
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="rails_redis_client",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_6h{component="rails_redis_client",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="rails_redis_client",tier="db",type="redis"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_6h{component="rails_redis_client",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="rails_redis_client",tier="db",type="redis"} / gitlab_component_apdex:weight:score_6h{component="rails_redis_client",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="rails_redis_client",tier="db",type="redis"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="rails_redis_client",tier="db",type="redis"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="rails_redis_client",tier="db",type="redis"} * 21600)),
        0, 1
      )
    labels:
      component: rails_redis_client
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_cache_operation_duration_seconds_bucket{le="0.1"}[6h])
        )
        +
        sum by () (
          rate(gitlab_cache_operation_duration_seconds_bucket{le="0.25"}[6h])
        )
      )
      /
      2
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(gitlab_cache_operation_duration_seconds_bucket{le="+Inf"}[6h])
      )
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(gitlab_cache_operation_duration_seconds_count{}[6h])
      )
    labels:
      component: redis
      stage: main
      tier: db
      type: redis
    record: gitlab_component_ops:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="redis",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="redis",tier="db",type="redis"}
      )
    labels:
      component: redis
      tier: db
      type: redis
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="redis",tier="db",type="redis"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="redis",tier="db",type="redis"}
      )
    labels:
      component: redis
      tier: db
      type: redis
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="redis",tier="db",type="redis"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_6h{component="redis",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="redis",tier="db",type="redis"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_6h{component="redis",tier="db",type="redis"}) * (1 - (gitlab_component_errors:rate_6h{component="redis",tier="db",type="redis"} / gitlab_component_ops:rate_6h{component="redis",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="redis",tier="db",type="redis"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="redis",tier="db",type="redis"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="redis",tier="db",type="redis"} * 21600)),
        0, 1
      )
    labels:
      component: redis
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="redis",tier="db",type="redis"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_6h{component="redis",tier="db",type="redis"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="redis",tier="db",type="redis"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_6h{component="redis",tier="db",type="redis"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="redis",tier="db",type="redis"} / gitlab_component_apdex:weight:score_6h{component="redis",tier="db",type="redis"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="redis",tier="db",type="redis"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="redis",tier="db",type="redis"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="redis",tier="db",type="redis"} * 21600)),
        0, 1
      )
    labels:
      component: redis
      confidence: 98%
      tier: db
      type: redis
    record: gitlab_component_apdex:confidence:ratio_6h
- interval: 1m
  name: 'Component mapping: redis'
  rules:
  - expr: "1"
    labels:
      component: primary_server
      regional_aggregation: "no"
      service_aggregation: "no"
      tier: db
      type: redis
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: rails_redis_client
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: db
      type: redis
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: redis
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: db
      type: redis
    record: gitlab_component_service:mapping
- interval: 1m
  name: 'Component-Level SLIs: registry - 5m burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[5m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[5m])
        )
      )
      /
      2
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[5m])
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(registry_http_requests_total{}[5m])
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(registry_http_requests_total{code=~"5.."}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"}
        )
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="server",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"}
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="server",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="server",tier="sv",type="registry"}
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_5m{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="server",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="server",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="server",tier="sv",type="registry"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="server",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="server",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="server",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="0.5",method=~"delete",route="/v2/{name}/blobs/{digest}"}[5m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"delete",route="/v2/{name}/blobs/{digest}"}[5m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"delete",route="/v2/{name}/blobs/{digest}"}[5m])
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"delete",route="/v2/{name}/blobs/{digest}"}[5m])
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="10",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[5m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="60",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[5m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[5m])
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"get|head",route="/v2/{name}/blobs/{digest}"}[5m])
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[5m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[5m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[5m])
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[5m])
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="5",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="1",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="60",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[5m])
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 300)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_5m
- interval: 2m
  name: 'Component-Level SLIs: registry - 30m burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[30m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[30m])
        )
      )
      /
      2
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[30m])
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(registry_http_requests_total{}[30m])
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(registry_http_requests_total{code=~"5.."}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"}
        )
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="server",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"}
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="server",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="server",tier="sv",type="registry"}
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_30m{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="server",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="server",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="server",tier="sv",type="registry"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="server",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="server",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="server",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="0.5",method=~"delete",route="/v2/{name}/blobs/{digest}"}[30m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"delete",route="/v2/{name}/blobs/{digest}"}[30m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"delete",route="/v2/{name}/blobs/{digest}"}[30m])
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"delete",route="/v2/{name}/blobs/{digest}"}[30m])
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="10",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[30m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="60",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[30m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[30m])
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"get|head",route="/v2/{name}/blobs/{digest}"}[30m])
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[30m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[30m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[30m])
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[30m])
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="5",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="1",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="60",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[30m])
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 1800)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_30m
- interval: 1m
  name: 'Component-Level SLIs: registry - 1h burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[1h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[1h])
        )
      )
      /
      2
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[1h])
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(registry_http_requests_total{}[1h])
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(registry_http_requests_total{code=~"5.."}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"}
        )
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="server",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"}
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="server",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="server",tier="sv",type="registry"}
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_1h{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="server",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="server",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="server",tier="sv",type="registry"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="server",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="server",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="server",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="0.5",method=~"delete",route="/v2/{name}/blobs/{digest}"}[1h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"delete",route="/v2/{name}/blobs/{digest}"}[1h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"delete",route="/v2/{name}/blobs/{digest}"}[1h])
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"delete",route="/v2/{name}/blobs/{digest}"}[1h])
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="10",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[1h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="60",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[1h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[1h])
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"get|head",route="/v2/{name}/blobs/{digest}"}[1h])
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[1h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[1h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[1h])
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[1h])
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="5",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="1",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="60",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[1h])
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 3600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_1h
- interval: 2m
  name: 'Component-Level SLIs: registry - 6h burn-rate'
  rules:
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[6h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[6h])
        )
      )
      /
      2
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",route!~"/v2/{name}/blobs/uploads/{uuid}|/v2/{name}/blobs/{digest}"}[6h])
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(registry_http_requests_total{}[6h])
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(registry_http_requests_total{code=~"5.."}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"}
        )
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="server",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"}
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="server",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="server",tier="sv",type="registry"}
      )
    labels:
      component: server
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_6h{component="server",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="server",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="server",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="server",tier="sv",type="registry"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="server",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="server",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="server",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="server",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="0.5",method=~"delete",route="/v2/{name}/blobs/{digest}"}[6h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"delete",route="/v2/{name}/blobs/{digest}"}[6h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"delete",route="/v2/{name}/blobs/{digest}"}[6h])
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"delete",route="/v2/{name}/blobs/{digest}"}[6h])
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_deletes",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="10",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[6h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="60",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[6h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"get|head",route="/v2/{name}/blobs/{digest}"}[6h])
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"get|head",route="/v2/{name}/blobs/{digest}"}[6h])
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_reads",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[6h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[6h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[6h])
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"patch|post|put",route="/v2/{name}/blobs/{digest}"}[6h])
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_digest_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="server_route_blob_digest_writes",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_digest_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="5",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"delete",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_deletes",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_deletes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="1",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="2.5",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"get|head",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_reads",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_reads
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      (
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="25",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
        )
        +
        sum by () (
          rate(registry_http_request_duration_seconds_bucket{le="60",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
        )
      )
      /
      2
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_bucket{le="+Inf",method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(registry_http_request_duration_seconds_count{method=~"patch|post|put",route="/v2/{name}/blobs/uploads/{uuid}"}[6h])
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_ops:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      tier: sv
      type: registry
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_errors:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} / gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="server_route_blob_upload_uuid_writes",tier="sv",type="registry"} * 21600)),
        0, 1
      )
    labels:
      component: server_route_blob_upload_uuid_writes
      confidence: 98%
      tier: sv
      type: registry
    record: gitlab_component_apdex:confidence:ratio_6h
- interval: 1m
  name: 'Component mapping: registry'
  rules:
  - expr: "1"
    labels:
      component: server
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: registry
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: server_route_blob_digest_deletes
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: registry
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: server_route_blob_digest_reads
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: registry
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: server_route_blob_digest_writes
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: registry
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: server_route_blob_upload_uuid_deletes
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: registry
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: server_route_blob_upload_uuid_reads
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: registry
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: server_route_blob_upload_uuid_writes
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: registry
    record: gitlab_component_service:mapping
- interval: 1m
  name: 'Component-Level SLIs: sidekiq - 5m burn-rate'
  rules:
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_completion_seconds_bucket[5m] offset 30s)
      )
    record: sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_queue_duration_seconds_bucket[5m] offset 30s)
      )
    record: sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m
  - expr: |
      sum by (environment,feature_category,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_failed_total[5m] offset 30s)
      )
    record: sli_aggregations:sidekiq_jobs_failed_total_rate5m
  - expr: |
      sum by () (
        rate(sidekiq_jobs_completion_seconds_count{worker=~"EmailReceiverWorker|ServiceDeskEmailReceiverWorker"}[5m])
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_transaction_event_email_receiver_error_total{error!="Gitlab::Email::AutoGeneratedEmailError"}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="email_receiver",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"}
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="email_receiver",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="email_receiver",tier="sv",type="sidekiq"}
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_errors:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} * 300)),
        0, 1
      )
    labels:
      component: email_receiver
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="email_receiver",tier="sv",type="sidekiq"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_5m{component="email_receiver",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="email_receiver",tier="sv",type="sidekiq"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_5m{component="email_receiver",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_5m{component="email_receiver",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="email_receiver",tier="sv",type="sidekiq"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="email_receiver",tier="sv",type="sidekiq"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="email_receiver",tier="sv",type="sidekiq"} * 300)),
        0, 1
      )
    labels:
      component: email_receiver
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      sum by () (
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="10",urgency="high"}
        )
        , "_c", "0", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="10",urgency="high"}
        )
        , "_c", "1", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="300",urgency="low"}
        )
        , "_c", "2", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="60",urgency="low"}
        )
        , "_c", "3", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="300",urgency="throttled"}
        )
        , "_c", "4", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="300",urgency=""}
        )
        , "_c", "5", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="60",urgency=""}
        )
        , "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",urgency="high"}
        )
        , "_c", "0", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="+Inf",urgency="high"}
        )
        , "_c", "1", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",urgency="low"}
        )
        , "_c", "2", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="+Inf",urgency="low"}
        )
        , "_c", "3", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",urgency="throttled"}
        )
        , "_c", "4", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",urgency=""}
        )
        , "_c", "5", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="+Inf",urgency=""}
        )
        , "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          sli_aggregations:sidekiq_jobs_failed_total_rate5m{}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="shard_catchall",tier="sv",type="sidekiq"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_errors:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} * 300)),
        0, 1
      )
    labels:
      component: shard_catchall
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="shard_catchall",tier="sv",type="sidekiq"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_5m{component="shard_catchall",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="shard_catchall",tier="sv",type="sidekiq"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_5m{component="shard_catchall",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_5m{component="shard_catchall",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="shard_catchall",tier="sv",type="sidekiq"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="shard_catchall",tier="sv",type="sidekiq"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="shard_catchall",tier="sv",type="sidekiq"} * 300)),
        0, 1
      )
    labels:
      component: shard_catchall
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:confidence:ratio_5m
- interval: 2m
  name: 'Component-Level SLIs: sidekiq - 30m burn-rate'
  rules:
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_completion_seconds_bucket[30m] offset 30s)
      )
    record: sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_queue_duration_seconds_bucket[30m] offset 30s)
      )
    record: sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m
  - expr: |
      sum by (environment,feature_category,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_failed_total[30m] offset 30s)
      )
    record: sli_aggregations:sidekiq_jobs_failed_total_rate30m
  - expr: |
      sum by () (
        rate(sidekiq_jobs_completion_seconds_count{worker=~"EmailReceiverWorker|ServiceDeskEmailReceiverWorker"}[30m])
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_transaction_event_email_receiver_error_total{error!="Gitlab::Email::AutoGeneratedEmailError"}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="email_receiver",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"}
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="email_receiver",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="email_receiver",tier="sv",type="sidekiq"}
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_errors:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} * 1800)),
        0, 1
      )
    labels:
      component: email_receiver
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="email_receiver",tier="sv",type="sidekiq"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_30m{component="email_receiver",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="email_receiver",tier="sv",type="sidekiq"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_30m{component="email_receiver",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_30m{component="email_receiver",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="email_receiver",tier="sv",type="sidekiq"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="email_receiver",tier="sv",type="sidekiq"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="email_receiver",tier="sv",type="sidekiq"} * 1800)),
        0, 1
      )
    labels:
      component: email_receiver
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      sum by () (
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="10",urgency="high"}
        )
        , "_c", "0", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="10",urgency="high"}
        )
        , "_c", "1", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="300",urgency="low"}
        )
        , "_c", "2", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="60",urgency="low"}
        )
        , "_c", "3", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="300",urgency="throttled"}
        )
        , "_c", "4", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="300",urgency=""}
        )
        , "_c", "5", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="60",urgency=""}
        )
        , "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",urgency="high"}
        )
        , "_c", "0", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="+Inf",urgency="high"}
        )
        , "_c", "1", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",urgency="low"}
        )
        , "_c", "2", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="+Inf",urgency="low"}
        )
        , "_c", "3", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",urgency="throttled"}
        )
        , "_c", "4", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",urgency=""}
        )
        , "_c", "5", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="+Inf",urgency=""}
        )
        , "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          sli_aggregations:sidekiq_jobs_failed_total_rate30m{}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="shard_catchall",tier="sv",type="sidekiq"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_errors:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} * 1800)),
        0, 1
      )
    labels:
      component: shard_catchall
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="shard_catchall",tier="sv",type="sidekiq"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_30m{component="shard_catchall",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="shard_catchall",tier="sv",type="sidekiq"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_30m{component="shard_catchall",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_30m{component="shard_catchall",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="shard_catchall",tier="sv",type="sidekiq"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="shard_catchall",tier="sv",type="sidekiq"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="shard_catchall",tier="sv",type="sidekiq"} * 1800)),
        0, 1
      )
    labels:
      component: shard_catchall
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:confidence:ratio_30m
- interval: 1m
  name: 'Component-Level SLIs: sidekiq - 1h burn-rate'
  rules:
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_completion_seconds_bucket[1h] offset 30s)
      )
    record: sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_queue_duration_seconds_bucket[1h] offset 30s)
      )
    record: sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h
  - expr: |
      sum by (environment,feature_category,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_failed_total[1h] offset 30s)
      )
    record: sli_aggregations:sidekiq_jobs_failed_total_rate1h
  - expr: |
      sum by () (
        rate(sidekiq_jobs_completion_seconds_count{worker=~"EmailReceiverWorker|ServiceDeskEmailReceiverWorker"}[1h])
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_transaction_event_email_receiver_error_total{error!="Gitlab::Email::AutoGeneratedEmailError"}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="email_receiver",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"}
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="email_receiver",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="email_receiver",tier="sv",type="sidekiq"}
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_errors:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} * 3600)),
        0, 1
      )
    labels:
      component: email_receiver
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="email_receiver",tier="sv",type="sidekiq"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_1h{component="email_receiver",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="email_receiver",tier="sv",type="sidekiq"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_1h{component="email_receiver",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_1h{component="email_receiver",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="email_receiver",tier="sv",type="sidekiq"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="email_receiver",tier="sv",type="sidekiq"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="email_receiver",tier="sv",type="sidekiq"} * 3600)),
        0, 1
      )
    labels:
      component: email_receiver
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      sum by () (
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="10",urgency="high"}
        )
        , "_c", "0", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="10",urgency="high"}
        )
        , "_c", "1", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="300",urgency="low"}
        )
        , "_c", "2", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="60",urgency="low"}
        )
        , "_c", "3", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="300",urgency="throttled"}
        )
        , "_c", "4", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="300",urgency=""}
        )
        , "_c", "5", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="60",urgency=""}
        )
        , "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",urgency="high"}
        )
        , "_c", "0", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="+Inf",urgency="high"}
        )
        , "_c", "1", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",urgency="low"}
        )
        , "_c", "2", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="+Inf",urgency="low"}
        )
        , "_c", "3", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",urgency="throttled"}
        )
        , "_c", "4", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",urgency=""}
        )
        , "_c", "5", "", "")
        or
        label_replace(sum by () (
          sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="+Inf",urgency=""}
        )
        , "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          sli_aggregations:sidekiq_jobs_failed_total_rate1h{}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="shard_catchall",tier="sv",type="sidekiq"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_errors:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} * 3600)),
        0, 1
      )
    labels:
      component: shard_catchall
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="shard_catchall",tier="sv",type="sidekiq"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_1h{component="shard_catchall",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="shard_catchall",tier="sv",type="sidekiq"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_1h{component="shard_catchall",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_1h{component="shard_catchall",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="shard_catchall",tier="sv",type="sidekiq"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="shard_catchall",tier="sv",type="sidekiq"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="shard_catchall",tier="sv",type="sidekiq"} * 3600)),
        0, 1
      )
    labels:
      component: shard_catchall
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:confidence:ratio_1h
- interval: 2m
  name: 'Component-Level SLIs: sidekiq - 6h burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(sidekiq_jobs_completion_seconds_count{worker=~"EmailReceiverWorker|ServiceDeskEmailReceiverWorker"}[6h])
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_transaction_event_email_receiver_error_total{error!="Gitlab::Email::AutoGeneratedEmailError"}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="email_receiver",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"}
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="email_receiver",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="email_receiver",tier="sv",type="sidekiq"}
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_errors:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} * 21600)),
        0, 1
      )
    labels:
      component: email_receiver
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="email_receiver",tier="sv",type="sidekiq"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_6h{component="email_receiver",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="email_receiver",tier="sv",type="sidekiq"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_6h{component="email_receiver",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="email_receiver",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_6h{component="email_receiver",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="email_receiver",tier="sv",type="sidekiq"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="email_receiver",tier="sv",type="sidekiq"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="email_receiver",tier="sv",type="sidekiq"} * 21600)),
        0, 1
      )
    labels:
      component: email_receiver
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="shard_catchall",tier="sv",type="sidekiq"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_errors:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_ops:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} * 21600)),
        0, 1
      )
    labels:
      component: shard_catchall
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="shard_catchall",tier="sv",type="sidekiq"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_6h{component="shard_catchall",tier="sv",type="sidekiq"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="shard_catchall",tier="sv",type="sidekiq"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_6h{component="shard_catchall",tier="sv",type="sidekiq"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="shard_catchall",tier="sv",type="sidekiq"} / gitlab_component_apdex:weight:score_6h{component="shard_catchall",tier="sv",type="sidekiq"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="shard_catchall",tier="sv",type="sidekiq"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="shard_catchall",tier="sv",type="sidekiq"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="shard_catchall",tier="sv",type="sidekiq"} * 21600)),
        0, 1
      )
    labels:
      component: shard_catchall
      confidence: 98%
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:confidence:ratio_6h
- interval: 1m
  name: 'Component mapping: sidekiq'
  rules:
  - expr: "1"
    labels:
      component: email_receiver
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: sidekiq
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: shard_catchall
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: sidekiq
    record: gitlab_component_service:mapping
- interval: 1m
  name: 'Component-Level SLIs: webservice - 5m burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_apdex_success_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[5m])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_apdex_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[5m])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[5m])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_sli_graphql_query_error_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"}
        )
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="graphql_query",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"}
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="graphql_query",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="graphql_query",tier="sv",type="webservice"}
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_5m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="graphql_query",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: graphql_query
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="graphql_query",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="graphql_query",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="graphql_query",tier="sv",type="webservice"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="graphql_query",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="graphql_query",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="graphql_query",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="graphql_query",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="graphql_query",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: graphql_query
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      sum by () (
        rate(gitlab_sli_rails_request_apdex_success_total{job="gitlab-rails"}[5m])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(gitlab_sli_rails_request_apdex_total{job="gitlab-rails"}[5m])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(http_requests_total{job="gitlab-rails"}[5m])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(http_requests_total{job="gitlab-rails",status=~"5.."}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"}
        )
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="puma",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"}
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="puma",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="puma",tier="sv",type="webservice"}
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_5m{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="puma",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: puma
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="puma",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="puma",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="puma",tier="sv",type="webservice"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="puma",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="puma",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="puma",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="puma",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="puma",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: puma
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="1",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[5m])
        )
        +
        sum by () (
          rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[5m])
        )
      )
      /
      2
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[5m])
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[5m])
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="workhorse",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="workhorse",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="workhorse",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_5m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="workhorse",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: workhorse
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="workhorse",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="workhorse",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="workhorse",tier="sv",type="webservice"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="workhorse",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="workhorse",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="workhorse",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="workhorse",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="workhorse",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: workhorse
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[5m])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[5m])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[5m])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="workhorse_api",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="workhorse_api",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="workhorse_api",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_5m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="workhorse_api",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: workhorse_api
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="workhorse_api",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="workhorse_api",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="workhorse_api",tier="sv",type="webservice"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="workhorse_api",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="workhorse_api",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="workhorse_api",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="workhorse_api",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="workhorse_api",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: workhorse_api
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_5m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route="^/.+\\.git/info/refs\\z"}[5m])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route="^/.+\\.git/info/refs\\z"}[5m])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route=~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z"}[5m])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route=~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z"}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_5m{component="workhorse_git",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_5m{component="workhorse_git",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_5m{component="workhorse_git",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      (gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_5m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"} * 300))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_5m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_5m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_5m{component="workhorse_git",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: workhorse_git
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_5m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_5m{component="workhorse_git",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_5m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="workhorse_git",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_5m{component="workhorse_git",tier="sv",type="webservice"} * 300))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_5m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="workhorse_git",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_5m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_5m{component="workhorse_git",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_5m{component="workhorse_git",tier="sv",type="webservice"} * 300))
            )
            /
            (gitlab_component_apdex:weight:score_5m{component="workhorse_git",tier="sv",type="webservice"} * 300)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_5m{component="workhorse_git",tier="sv",type="webservice"} * 300)),
        0, 1
      )
    labels:
      component: workhorse_git
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_5m
- interval: 2m
  name: 'Component-Level SLIs: webservice - 30m burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_apdex_success_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[30m])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_apdex_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[30m])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[30m])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_sli_graphql_query_error_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"}
        )
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="graphql_query",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"}
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="graphql_query",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="graphql_query",tier="sv",type="webservice"}
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_30m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="graphql_query",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: graphql_query
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="graphql_query",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="graphql_query",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="graphql_query",tier="sv",type="webservice"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="graphql_query",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="graphql_query",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="graphql_query",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="graphql_query",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="graphql_query",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: graphql_query
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      sum by () (
        rate(gitlab_sli_rails_request_apdex_success_total{job="gitlab-rails"}[30m])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(gitlab_sli_rails_request_apdex_total{job="gitlab-rails"}[30m])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(http_requests_total{job="gitlab-rails"}[30m])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(http_requests_total{job="gitlab-rails",status=~"5.."}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"}
        )
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="puma",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"}
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="puma",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="puma",tier="sv",type="webservice"}
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_30m{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="puma",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: puma
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="puma",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="puma",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="puma",tier="sv",type="webservice"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="puma",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="puma",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="puma",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="puma",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="puma",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: puma
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="1",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[30m])
        )
        +
        sum by () (
          rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[30m])
        )
      )
      /
      2
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[30m])
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[30m])
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="workhorse",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="workhorse",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="workhorse",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_30m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="workhorse",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: workhorse
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="workhorse",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="workhorse",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="workhorse",tier="sv",type="webservice"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="workhorse",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="workhorse",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="workhorse",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="workhorse",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="workhorse",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: workhorse
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[30m])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[30m])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[30m])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="workhorse_api",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="workhorse_api",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="workhorse_api",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_30m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="workhorse_api",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: workhorse_api
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="workhorse_api",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="workhorse_api",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="workhorse_api",tier="sv",type="webservice"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="workhorse_api",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="workhorse_api",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="workhorse_api",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="workhorse_api",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="workhorse_api",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: workhorse_api
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_30m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route="^/.+\\.git/info/refs\\z"}[30m])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route="^/.+\\.git/info/refs\\z"}[30m])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route=~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z"}[30m])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route=~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z"}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        gitlab_component_errors:rate_30m{component="workhorse_git",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_30m{component="workhorse_git",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_30m{component="workhorse_git",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      (gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_30m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"} * 1800))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_30m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_30m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_30m{component="workhorse_git",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: workhorse_git
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_30m
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_30m{component="workhorse_git",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_30m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="workhorse_git",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_30m{component="workhorse_git",tier="sv",type="webservice"} * 1800))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_30m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="workhorse_git",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_30m{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_30m{component="workhorse_git",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_30m{component="workhorse_git",tier="sv",type="webservice"} * 1800))
            )
            /
            (gitlab_component_apdex:weight:score_30m{component="workhorse_git",tier="sv",type="webservice"} * 1800)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_30m{component="workhorse_git",tier="sv",type="webservice"} * 1800)),
        0, 1
      )
    labels:
      component: workhorse_git
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_30m
- interval: 1m
  name: 'Component-Level SLIs: webservice - 1h burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_apdex_success_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[1h])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_apdex_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[1h])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[1h])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_sli_graphql_query_error_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"}
        )
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="graphql_query",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"}
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="graphql_query",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="graphql_query",tier="sv",type="webservice"}
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_1h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="graphql_query",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: graphql_query
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="graphql_query",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="graphql_query",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="graphql_query",tier="sv",type="webservice"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="graphql_query",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="graphql_query",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="graphql_query",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="graphql_query",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="graphql_query",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: graphql_query
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      sum by () (
        rate(gitlab_sli_rails_request_apdex_success_total{job="gitlab-rails"}[1h])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(gitlab_sli_rails_request_apdex_total{job="gitlab-rails"}[1h])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(http_requests_total{job="gitlab-rails"}[1h])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(http_requests_total{job="gitlab-rails",status=~"5.."}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"}
        )
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="puma",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"}
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="puma",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="puma",tier="sv",type="webservice"}
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_1h{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="puma",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: puma
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="puma",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="puma",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="puma",tier="sv",type="webservice"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="puma",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="puma",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="puma",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="puma",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="puma",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: puma
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="1",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[1h])
        )
        +
        sum by () (
          rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[1h])
        )
      )
      /
      2
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[1h])
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[1h])
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="workhorse",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="workhorse",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="workhorse",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_1h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="workhorse",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: workhorse
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="workhorse",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="workhorse",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="workhorse",tier="sv",type="webservice"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="workhorse",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="workhorse",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="workhorse",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="workhorse",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="workhorse",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: workhorse
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[1h])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[1h])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[1h])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="workhorse_api",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="workhorse_api",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="workhorse_api",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_1h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="workhorse_api",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: workhorse_api
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="workhorse_api",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="workhorse_api",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="workhorse_api",tier="sv",type="webservice"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="workhorse_api",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="workhorse_api",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="workhorse_api",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="workhorse_api",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="workhorse_api",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: workhorse_api
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_1h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route="^/.+\\.git/info/refs\\z"}[1h])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route="^/.+\\.git/info/refs\\z"}[1h])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route=~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z"}[1h])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route=~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z"}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_1h{component="workhorse_git",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_1h{component="workhorse_git",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_1h{component="workhorse_git",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_1h
  - expr: |
      (gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_1h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"} * 3600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_1h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_1h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_1h{component="workhorse_git",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: workhorse_git
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_1h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_1h{component="workhorse_git",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_1h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="workhorse_git",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_1h{component="workhorse_git",tier="sv",type="webservice"} * 3600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_1h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="workhorse_git",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_1h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_1h{component="workhorse_git",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_1h{component="workhorse_git",tier="sv",type="webservice"} * 3600))
            )
            /
            (gitlab_component_apdex:weight:score_1h{component="workhorse_git",tier="sv",type="webservice"} * 3600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_1h{component="workhorse_git",tier="sv",type="webservice"} * 3600)),
        0, 1
      )
    labels:
      component: workhorse_git
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_1h
- interval: 2m
  name: 'Component-Level SLIs: webservice - 6h burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_apdex_success_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[6h])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_apdex_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[6h])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(gitlab_sli_graphql_query_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[6h])
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_sli_graphql_query_error_total{endpoint_id!="graphql:unknown",job="gitlab-rails"}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"}
        )
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="graphql_query",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"}
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="graphql_query",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="graphql_query",tier="sv",type="webservice"}
      )
    labels:
      component: graphql_query
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_6h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="graphql_query",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: graphql_query
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="graphql_query",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="graphql_query",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="graphql_query",tier="sv",type="webservice"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="graphql_query",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="graphql_query",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="graphql_query",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="graphql_query",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="graphql_query",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="graphql_query",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: graphql_query
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      sum by () (
        rate(gitlab_sli_rails_request_apdex_success_total{job="gitlab-rails"}[6h])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(gitlab_sli_rails_request_apdex_total{job="gitlab-rails"}[6h])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(http_requests_total{job="gitlab-rails"}[6h])
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(http_requests_total{job="gitlab-rails",status=~"5.."}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"}
        )
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="puma",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"}
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="puma",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="puma",tier="sv",type="webservice"}
      )
    labels:
      component: puma
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_6h{component="puma",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="puma",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: puma
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="puma",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="puma",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="puma",tier="sv",type="webservice"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="puma",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="puma",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="puma",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="puma",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="puma",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="puma",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: puma
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="1",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[6h])
        )
        +
        sum by () (
          rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[6h])
        )
      )
      /
      2
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/-/cable\\z",route!="^/v2/.+/containers/.+/blobs/sha256:[a-z0-9]+\\z",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[6h])
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[6h])
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route!~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z",route!~"^\\^/api/.*"}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="workhorse",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="workhorse",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="workhorse",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_6h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="workhorse",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: workhorse
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="workhorse",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="workhorse",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="workhorse",tier="sv",type="webservice"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="workhorse",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="workhorse",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="workhorse",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="workhorse",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="workhorse",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="workhorse",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: workhorse
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[6h])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[6h])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[6h])
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route!="^/-/health$",route!="^/-/(readiness|liveness)$",route=~"^\\^/api/.*"}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="workhorse_api",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="workhorse_api",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="workhorse_api",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_api
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_6h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="workhorse_api",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: workhorse_api
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="workhorse_api",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="workhorse_api",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="workhorse_api",tier="sv",type="webservice"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="workhorse_api",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="workhorse_api",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="workhorse_api",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="workhorse_api",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="workhorse_api",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="workhorse_api",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: workhorse_api
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_6h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route="^/.+\\.git/info/refs\\z"}[6h])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="+Inf",route="^/.+\\.git/info/refs\\z"}[6h])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        rate(gitlab_workhorse_http_requests_total{route=~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z"}[6h])
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_workhorse_http_requests_total{code=~"^5.*",route=~"\\^/\\.\\+\\\\\\.git/git-receive-pack\\\\z|\\^/\\.\\+\\\\\\.git/git-upload-pack\\\\z|\\^/\\.\\+\\\\\\.git/gitlab-lfs/objects/\\(\\[0-9a-f\\]\\{64\\}\\)/\\(\\[0-9\\]\\+\\)\\\\z|\\^/\\.\\+\\\\\\.git/info/refs\\\\z"}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"}
        )
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_errors:rate_6h
  - expr: |
      sum by () (
        gitlab_component_errors:rate_6h{component="workhorse_git",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by () (
        gitlab_component_apdex:success:rate_6h{component="workhorse_git",tier="sv",type="webservice"}
      )
      /
      sum by () (
        gitlab_component_apdex:weight:score_6h{component="workhorse_git",tier="sv",type="webservice"}
      )
    labels:
      component: workhorse_git
      tier: sv
      type: webservice
    record: gitlab_component_apdex:ratio_6h
  - expr: |
      (gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"} == 0)
      or
      clamp(
        (
          (
            (gitlab_component_errors:rate_6h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"} * 21600))
          )
          -
          2.326348
          *
          sqrt(
            (
              (gitlab_component_errors:rate_6h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"}) * (1 - (gitlab_component_errors:rate_6h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_ops:rate_6h{component="workhorse_git",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: workhorse_git
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_errors:confidence:ratio_6h
  - expr: |
      clamp_min(gitlab_component_apdex:weight:score_6h{component="workhorse_git",tier="sv",type="webservice"} == 0, 1)
      or
      clamp(
        (
          (
            (gitlab_component_apdex:success:rate_6h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="workhorse_git",tier="sv",type="webservice"})
            +
            5.411894 / (2 * (gitlab_component_apdex:weight:score_6h{component="workhorse_git",tier="sv",type="webservice"} * 21600))
          )
          +
          2.326348
          *
          sqrt(
            (
              (gitlab_component_apdex:success:rate_6h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="workhorse_git",tier="sv",type="webservice"}) * (1 - (gitlab_component_apdex:success:rate_6h{component="workhorse_git",tier="sv",type="webservice"} / gitlab_component_apdex:weight:score_6h{component="workhorse_git",tier="sv",type="webservice"}))
              +
              5.411894 / (4 * (gitlab_component_apdex:weight:score_6h{component="workhorse_git",tier="sv",type="webservice"} * 21600))
            )
            /
            (gitlab_component_apdex:weight:score_6h{component="workhorse_git",tier="sv",type="webservice"} * 21600)
          )
        )
        /
        (1 + 5.411894 / (gitlab_component_apdex:weight:score_6h{component="workhorse_git",tier="sv",type="webservice"} * 21600)),
        0, 1
      )
    labels:
      component: workhorse_git
      confidence: 98%
      tier: sv
      type: webservice
    record: gitlab_component_apdex:confidence:ratio_6h
- interval: 1m
  name: 'Component mapping: webservice'
  rules:
  - expr: "1"
    labels:
      component: graphql_query
      regional_aggregation: "no"
      service_aggregation: "no"
      tier: sv
      type: webservice
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: puma
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: webservice
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: workhorse
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: webservice
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: workhorse_api
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: webservice
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: workhorse_git
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: webservice
    record: gitlab_component_service:mapping
