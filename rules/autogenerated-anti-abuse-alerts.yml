# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./rules-jsonnet/anti-abuse-alerts.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: anti_abuse_alerts
  rules:
  - alert: RunnerJobDurationSpikeDetected
    for: 3m
    annotations:
      title: Suspicious spike detected in the runner job durations.
      description: |
        The sum total time of CI jobs exceeded a threshold of 2500 seconds per second for a 3 minute period; this can indicate crypto mining or other pipeline abuse.
      grafana_dashboard_id: ci-runners-business-stats
      grafana_dashboard_link: https://dashboards.gitlab.net/d/ci-runners-business-stats?from=now-4h/m&to=now-1m/m&var-environment={{
        $labels.environment }}
      grafana_min_zoom_hours: "4"
      grafana_variables: environment
    labels:
      alert_type: symptom
      severity: s4
      team: anti_abuse
    expr: |
      sum by (environment, tier, type)  (
        rate(
          gitlab_runner_job_duration_seconds_sum{shard="shared"}[5m]
         )
       )
       > 2500
